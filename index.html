<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fly Express â€” Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800;900&display=swap" rel="stylesheet">
<style>
:root{
  --brand: #22d3ee;     /* Ø³Ù…Ø§ÙˆÙŠ */
  --accent:#10b981;     /* Ø£Ø®Ø¶Ø± */
  --danger:#ef4444;     /* Ø£Ø­Ù…Ø± */
  --ink:#eaf2ff;
  --muted:#b6c2d6;
  --glass: rgba(255,255,255,.06);
  --ring: #27f7c4;
  --shadow: 0 18px 55px rgba(0,0,0,.35);
  --radius: 22px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--ink); font-family:"Cairo",system-ui,sans-serif;
  /* Ø®Ù„ÙÙŠØ© RPG Ù…ØªØ­Ø±ÙƒØ© */
  background:
    radial-gradient(1200px 600px at 10% 10%, #0b1220 0%, transparent 60%),
    radial-gradient(1200px 600px at 90% 90%, #06121a 0%, transparent 60%),
    conic-gradient(from 0deg at 50% 50%, #07111a, #0e1f33, #0c2641, #0e1f33, #07111a);
  background-size:140% 140%,140% 140%,200% 200%;
  animation:bg1 16s ease-in-out infinite, bg2 22s ease-in-out infinite, hue 38s linear infinite;
}
@keyframes bg1{0%,100%{background-position:10% 10%,90% 90%, 0% 50%} 50%{background-position:28% 18%,72% 82%, 100% 50%}}
@keyframes bg2{0%,100%{filter:brightness(1)} 50%{filter:brightness(1.05)}}
@keyframes hue{0%{filter:hue-rotate(0)}100%{filter:hue-rotate(360deg)}}

.container{
  max-width:860px; margin:28px auto; padding:16px;
}
.card{
  background: rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.06);
  backdrop-filter: blur(8px);
  border-radius: 26px;
  padding: 20px;
  box-shadow: var(--shadow);
}

.header{
  display:flex; align-items:center; gap:12px; margin-bottom:6px;
}
.header h1{
  margin:0; font-size:38px; font-weight:900; letter-spacing:.5px;
}
.badge{
  margin-top:10px;
  background: linear-gradient(90deg,#22c55e,#facc15,#fb923c);
  color:#052e2b; font-weight:900;
  padding:10px 16px; border-radius:999px; display:inline-flex; gap:10px; align-items:center;
  box-shadow:0 12px 30px rgba(0,0,0,.25);
}

.sub{color:var(--muted); margin:10px 4px 14px; font-weight:700;}

/* Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ø¬Ù„Ø© */
.wheel-wrap{
  position:relative; display:flex; flex-direction:column; align-items:center;
}
.canvas-wrap{
  position:relative; width:min(520px, 90vw); aspect-ratio:1/1;
  border-radius:50%;
  padding:14px;
  background: radial-gradient(circle at 50% 50%, rgba(39,247,196,.15), transparent 65%);
}
.ring{
  position:absolute; inset:0; border-radius:50%;
  box-shadow: 0 0 0 10px #0b0e10, 0 0 0 18px var(--ring);
  pointer-events:none;
}
#wheel{
  width:100%; height:100%; border-radius:50%;
  box-shadow: inset 0 0 0 10px #0b0e10;
  transition: transform 6s cubic-bezier(.15,.8,.1,1);
  overflow:hidden;
  position:relative;
}
.slice{
  position:absolute; inset:0; clip-path: polygon(50% 50%, 100% 0, 100% 100%);
  display:flex; align-items:center; justify-content:center;
  transform-origin:50% 50%;
  font-size:54px; font-weight:900; color:#fff; text-shadow:0 4px 12px rgba(0,0,0,.6);
}
.slice small{font-size:46px}
.c1{background:#0ea5e9;}  /* 1 */
.c2{background:#fde68a; color:#0b1220;} /* 2 */
.c0{background:#f59e0b;}  /* 0 */
.c3{background:#1d4ed8;}  /* 3 */
.cx{background:#ef2a68;}  /* Ø­Ø¸ Ø£ÙˆÙØ± */

/* Ø§Ù„Ù…Ø¤Ø´Ø± ØªØ­Øª */
.pointer{
  position:absolute; bottom:-14px; left:50%; transform:translateX(-50%);
  width:0; height:0;
  border-left:16px solid transparent;
  border-right:16px solid transparent;
  border-top:26px solid #38bdf8; /* Ù…Ø«Ù„Ø« */
  filter: drop-shadow(0 6px 10px rgba(0,0,0,.5));
}

/* Ø£Ø²Ø±Ø§Ø± */
.actions{
  margin-top:12px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap;
}
.btn{
  border:none; cursor:pointer; padding:12px 18px; border-radius:999px;
  font-weight:900; color:#042b2b; background:#f59e0b;
  display:inline-flex; align-items:center; gap:10px; box-shadow:0 10px 28px rgba(0,0,0,.28);
}
.btn.secondary{background:#86efac; color:#06341e}
.btn:disabled{opacity:.55; cursor:not-allowed}

/* Ø§Ù„Ù†ØªÙŠØ¬Ø© */
.result{
  margin:14px auto 2px; padding:12px 14px; max-width:520px;
  border-radius:14px; text-align:center; font-weight:900; font-size:20px;
  display:none;
  background:rgba(34,197,94,.12);
  border:1px solid rgba(34,197,94,.35);
}
.result.bad{ background:rgba(239,68,68,.12); border-color:rgba(239,68,68,.35) }

/* Ø§Ù„Ø­Ø§Ù„Ø© */
.status{
  margin-top:16px; padding:14px; border-radius:18px; background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.08); color:var(--ink);
  display:grid; gap:8px;
}
.stat-row{display:flex; justify-content:space-between; align-items:center}
.bar{height:12px; border-radius:999px; background:#0f172a; overflow:hidden; border:1px solid rgba(255,255,255,.08)}
.bar .fill{height:100%; background:linear-gradient(90deg,#22c55e,#22d3ee); width:0%}

/* Toast */
.toast{
  position:fixed; bottom:24px; left:50%; transform:translateX(-50%);
  background:#0ea5e9; color:#062a30; padding:10px 16px; border-radius:12px; font-weight:900;
  box-shadow:0 12px 30px rgba(0,0,0,.35); display:none; z-index:50;
}
.toast.bad{background:#ef4444; color:#2b0b0b}

/* Ù…ÙˆØ¯Ø§Ù„ ÙƒÙŠÙ Ø£ÙƒØ³Ø¨ */
.modal{position:fixed; inset:0; display:none; place-items:center; z-index:60}
.modal .scrim{position:absolute; inset:0; background:rgba(0,0,0,.55)}
.modal .sheet{
  position:relative; background:#0b1220; border:1px solid rgba(255,255,255,.08);
  border-radius:18px; padding:18px; width:min(520px,92vw);
}
.modal h3{margin:0 0 8px; font-weight:900}
.modal .close{position:absolute; top:8px; inset-inline-start:8px; border:none; border-radius:10px; padding:6px 10px; cursor:pointer}

@media (max-width:520px){
  .header h1{font-size:30px}
  .slice{font-size:42px}
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <img src="https://i.ibb.co/B5MQWCWF/fly-express.jpg" alt="" width="54" height="54" style="border-radius:14px;border:1px solid rgba(255,255,255,.1)">
    <h1>Fly Express â€” <span style="color:#22eaaa">Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</span></h1>
  </div>

  <div class="badge">ğŸ Ù„ÙÙ‘ Ø§Ù„Ø¹Ø¬Ù„Ø© ÙˆØ§ÙƒØ³Ø¨ Ø¬ÙˆØ§Ø¦Ø²Ùƒ! <span style="opacity:.8">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ØªÙØªØ­ ÙƒÙ„ Ø®Ù…ÙŠØ³</span></div>

  <div class="card" style="margin-top:18px">
    <div class="sub">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ØªØªØ¬Ø¯Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙƒÙ„ Ø®Ù…ÙŠØ³. Ø§Ù„Ø³Ù‡Ù… <b>ØªØ­Øª</b> Ù‡Ùˆ Ø§Ù„Ù…Ø±Ø¬Ø¹ Ù„Ù„ÙÙˆØ².</div>

    <div class="wheel-wrap">
      <div class="canvas-wrap">
        <div id="wheel"></div>
        <div class="ring"></div>
        <div class="pointer"></div>
      </div>

      <div class="actions">
        <button id="spinBtn" class="btn"><span>ğŸ¯</span> Ù„ÙÙ‘ Ø§Ù„Ø¹Ø¬Ù„Ø©</button>
        <button id="howBtn" class="btn secondary"><span>â“</span> Ø¥Ø²Ù‘Ø§ÙŠ Ø£ÙƒØ³Ø¨ØŸ</button>
      </div>

      <div id="result" class="result"></div>

      <div class="status">
        <div class="stat-row"><div>Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:</div><div id="tries" style="font-weight:900">â€”</div></div>
        <div class="stat-row"><div>Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</div><div id="level">Lv 1</div></div>
        <div class="bar"><div id="xpFill" class="fill"></div></div>
        <div class="stat-row"><div>XP:</div><div id="xpText">0 / 100</div></div>
        <div class="stat-row">
          <div>Ù…Ø¹Ù„ÙˆÙ…Ø©:</div>
          <div id="hint" style="color:var(--muted)">Ù„Ùˆ Ù…Ø´ Ø§Ù„Ø®Ù…ÙŠØ³ Ù‡ØªØ¸Ù‡Ø± 0 Ù…Ø­Ø§ÙˆÙ„Ø©.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="scrim"></div>
  <div class="sheet">
    <button class="close" id="closeModal">âœ–</button>
    <h3>Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙÙˆØ²</h3>
    <ul>
      <li>Ø§Ù„Ø¹Ø¬Ù„Ø© ÙÙŠÙ‡Ø§ 0 Ùˆ 1 Ùˆ 2 Ùˆ 3 Ùˆ <b>Ø­Ø¸ Ø£ÙˆÙØ±</b>.</li>
      <li>Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ØªÙØªØ­ ÙƒÙ„ <b>Ø®Ù…ÙŠØ³</b> (Ø¥Ø¹Ø¯Ø§Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ù„ÙÙ‘ØªÙŠÙ†).</li>
      <li>ÙƒÙ„ Ù†ØªÙŠØ¬Ø© Ø¨ØªØ¯ÙŠ XPØ› Ù„Ù…Ø§ ØªØ¹Ø¨ÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ù‡ØªØªØ±Ù‚Ù‘Ù‰ Ù…Ø³ØªÙˆÙ‰.</li>
      <li>Ø§Ù„Ø³Ù‡Ù… ØªØ­Øª Ù‡Ùˆ Ø§Ù„Ù…Ø±Ø¬Ø¹â€”Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ù„ÙŠ Ù‡ÙŠÙ‚Ù Ø¹Ù†Ø¯Ù‡ Ù‡Ùˆ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©.</li>
    </ul>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
/* ================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ ================== */
const CONFIG = {
  weeklyTries: 2,                   // Ø¹Ø¯Ø¯ Ø§Ù„Ù„ÙØ§Øª ÙŠÙˆÙ… Ø§Ù„Ø®Ù…ÙŠØ³
  xpPerOutcome: { '0': 5, '1': 20, '2': 30, '3': 45, 'Ø­Ø¸ Ø£ÙˆÙØ±': 10 },
  levelStep: 100                    // XP Ù„ÙƒÙ„ Ù…Ø³ØªÙˆÙ‰
};
/* =========================================================== */

/* Ø­Ø§Ù„Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† */
const LS_KEY = 'fly_wheel_state_v3';
const defaultState = {
  rotation: 0,
  tries: 0,
  level: 1,
  xp: 0,
  lastThursday: '' // yyyy-mm-dd Ù„Ø¢Ø®Ø± Ø®Ù…ÙŠØ³ ØªÙ… ÙØªØ­Ù‡
};
let state = loadState();

/* Ø¹Ù†Ø§ØµØ± DOM */
const wheelEl = document.getElementById('wheel');
const spinBtn = document.getElementById('spinBtn');
const triesEl = document.getElementById('tries');
const levelEl = document.getElementById('level');
const xpFill = document.getElementById('xpFill');
const xpText = document.getElementById('xpText');
const resultBox = document.getElementById('result');
const hintEl = document.getElementById('hint');
const toastEl = document.getElementById('toast');
const modal = document.getElementById('modal');
document.getElementById('howBtn').onclick = ()=> modal.style.display='grid';
document.getElementById('closeModal').onclick = ()=> modal.style.display='none';
modal.querySelector('.scrim').onclick = ()=> modal.style.display='none';

/* ØªÙ‚Ø³ÙŠÙ…Ø§Øª Ø§Ù„Ø¹Ø¬Ù„Ø© */
const SEGMENTS = ['0','1','2','Ø­Ø¸ Ø£ÙˆÙØ±','3'];   // ØªØ±ØªÙŠØ¨ Ø¨Ø§Ù„Ø¹ÙƒØ³ Ø£Ùˆ Ù…Ø¹ Ø¹Ù‚Ø§Ø±Ø¨ØŸ Ø³Ù†Ø­Ø³Ø¨Ù‡Ø§ Ø¨Ø§Ù„Ø²Ø§ÙˆÙŠØ©
const SEG_SIZE = 360 / SEGMENTS.length;         // 72Â°
const PICK_DEG = 270;                            // Ø§Ù„Ø³Ù‡Ù… ØªØ­Øª

/* Ø±Ø³Ù… Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ */
(function draw(){
  wheelEl.innerHTML = '';
  for (let i=0;i<SEGMENTS.length;i++){
    const s = document.createElement('div');
    s.className = 'slice';
    const start = i*SEG_SIZE;
    s.style.transform = `rotate(${start}deg)`;
    s.style.clipPath = `polygon(50% 50%, 100% 0, 100% 100%)`;
    let cls = 'c0';
    const val = SEGMENTS[i];
    if (val==='1') cls='c1';
    else if (val==='2') cls='c2';
    else if (val==='3') cls='c3';
    else if (val==='Ø­Ø¸ Ø£ÙˆÙØ±') cls='cx';
    else cls='c0';
    s.classList.add(cls);

    const label = document.createElement('div');
    label.textContent = val;
    s.appendChild(label);
    wheelEl.appendChild(s);
  }
  wheelEl.style.borderRadius = '50%';
})();

/* ÙØªØ­ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙŠÙˆÙ… Ø§Ù„Ø®Ù…ÙŠØ³ ÙÙ‚Ø· */
resetTriesIfThursday();
updateUI();

/* Ø­Ø¯Ø« Ø§Ù„Ù„ÙØ© */
spinBtn.addEventListener('click', spin);

/* ============ Ø¯ÙˆØ§Ù„ ============ */
function spin(){
  if (state.tries <= 0){
    showToast('Ù…ÙÙŠØ´ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù†. Ø¬Ø±Ù‘Ø¨ ÙŠÙˆÙ… Ø§Ù„Ø®Ù…ÙŠØ³ âœ¨', false);
    return;
  }
  spinBtn.disabled = true;
  resultBox.style.display = 'none';

  const extra = 360*(5 + Math.floor(Math.random()*4)) + Math.floor(Math.random()*360);
  state.rotation = (state.rotation + extra) % (360*100000);
  wheelEl.style.transform = `rotate(${state.rotation}deg)`;

  setTimeout(()=>{
    const rot = state.rotation % 360;
    const selectedAngle = (PICK_DEG - rot + 360) % 360;
    const idx = Math.floor(selectedAngle / SEG_SIZE);
    const result = SEGMENTS[idx];

    state.tries -= 1;

    const gained = CONFIG.xpPerOutcome[result] || 0;
    const leveled = addXP(gained);

    let msg, good = true;
    if (result === 'Ø­Ø¸ Ø£ÙˆÙØ±'){
      msg = `Ø­Ø¸ Ø£ÙˆÙØ±! (+${gained} XP)`;
      good = false;
    }else{
      const n = Number(result);
      const txt = (n===0) ? 'ÙˆÙ„Ø§ ØªÙˆØµÙŠÙ„Ù‡' : (n===1 ? 'ØªÙˆØµÙŠÙ„Ø©' : 'ØªÙˆØµÙŠÙ„Ø§Øª');
      msg = (n===0) ? `Ù„Ù„Ø£Ø³Ù ${txt} (+${gained} XP)` : `Ù…Ø¨Ø±ÙˆÙƒ! ÙƒØ³Ø¨Øª ${n} ${txt} Ù…Ø¬Ø§Ù†ÙŠØ© ğŸ‰ (+${gained} XP)`;
      good = n>0;
    }
    resultBox.textContent = msg;
    resultBox.classList.toggle('bad', !good);
    resultBox.style.display = 'block';

    if (leveled){
      setTimeout(()=>showToast(`Ø§Ø±ØªÙ‚ÙŠØª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ ${state.level}! ğŸ”¥`, true), 900);
    }

    saveState();
    updateUI();
    spinBtn.disabled = false;
  }, 6100);
}

function addXP(amount){
  let leveled = false;
  state.xp += amount;
  while (state.xp >= CONFIG.levelStep){
    state.xp -= CONFIG.levelStep;
    state.level += 1;
    leveled = true;
  }
  return leveled;
}

function updateUI(){
  triesEl.textContent = state.tries;
  levelEl.textContent = `Lv ${state.level}`;
  xpText.textContent = `${state.xp} / ${CONFIG.levelStep}`;
  xpFill.style.width = `${(state.xp/CONFIG.levelStep)*100}%`;
}

function showToast(text, good=true){
  toastEl.textContent = text;
  toastEl.classList.toggle('bad', !good);
  toastEl.style.display = 'block';
  setTimeout(()=> toastEl.style.display='none', 2200);
}

/* ÙŠÙØªØ­ Ù„ÙÙ‘ØªÙŠÙ† ÙƒÙ„ Ø®Ù…ÙŠØ³ ÙÙ‚Ø· */
function resetTriesIfThursday(){
  const today = new Date();
  const isThu = today.getDay() === 4; // 0:Ø£Ø­Ø¯ ... 4:Ø®Ù…ÙŠØ³
  const thursdayId = nearestThursdayId(today);
  if (isThu){
    if (state.lastThursday !== thursdayId){
      state.lastThursday = thursdayId;
      state.tries = CONFIG.weeklyTries;
      saveState();
      showToast('ØªÙ… ÙØªØ­ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø®Ù…ÙŠØ³ âœ…', true);
    }
    hintEl.textContent = 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø®Ù…ÙŠØ³ â€” Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ÙØªÙˆØ­Ø© âœ…';
  }else{
    state.tries = 0; // Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ù…ÙŠØ³.. Ù…ØºÙ„Ù‚
    hintEl.textContent = 'Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ØªØªØ¬Ø¯Ø¯ ÙƒÙ„ Ø®Ù…ÙŠØ³.';
    saveState();
  }
}

/* Ø£Ù‚Ø±Ø¨ Ø®Ù…ÙŠØ³ (ØªØ§Ø±ÙŠØ® ÙÙ‚Ø·) */
function nearestThursdayId(d){
  const x = new Date(d);
  // Ø§Ø±Ø¬Ø¹ Ù„Ù„Ø®Ù…ÙŠØ³ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
  const diff = (4 - x.getDay() + 7) % 7; // Ø£ÙŠØ§Ù… Ù„Ø­Ø¯ Ø§Ù„Ø®Ù…ÙŠØ³ Ø§Ù„Ù‚Ø§Ø¯Ù…
  const th = new Date(x);
  th.setDate(x.getDate() + diff);
  return th.toISOString().slice(0,10); // yyyy-mm-dd
}

/* ØªØ®Ø²ÙŠÙ† */
function loadState(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if (!raw) return { ...defaultState };
    const obj = JSON.parse(raw);
    return { ...defaultState, ...obj };
  }catch{
    return { ...defaultState };
  }
}
function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
</script>
</body>
</html>
