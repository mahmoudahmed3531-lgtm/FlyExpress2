<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fly Express — عجلة الحظ</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --size: 310px;        /* قطر العجلة على الموبايل */
    --ring: #00ffb3;      /* لون الحلقة */
    --bg: #0c1320;
    --panel: rgba(255,255,255,.06);
    --text: #e9eef3;
    --muted:#aac0d0;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:'Cairo',system-ui,sans-serif; color:var(--text);
    background:
      radial-gradient(900px 500px at 10% 15%, #0a1a2f 0%, transparent 65%),
      radial-gradient(900px 500px at 90% 85%, #00131f 0%, transparent 65%),
      #07101c;
    display:flex; justify-content:center; padding:22px;
  }
  .wrap{width:100%; max-width:520px}

  h1{
    margin:0 0 6px; font-size:34px; font-weight:800; text-align:center;
  }
  .sub{ text-align:center; color:#63ff9c; font-size:28px; font-weight:800; margin-bottom:10px }
  .icon{font-size:28px; margin-inline:8px}

  .card{
    background:var(--panel); border:1px solid rgba(255,255,255,.08);
    border-radius:18px; padding:16px; backdrop-filter: blur(6px);
    box-shadow: 0 18px 40px rgba(0,0,0,.35);
  }

  /* لوحة العجلة */
  .wheel-box{ position:relative; display:flex; justify-content:center; align-items:center; padding-top:10px }
  .ring{
    position:absolute; width:calc(var(--size) + 18px); height:calc(var(--size) + 18px);
    border-radius:50%;
    box-shadow: 0 0 0 9px rgba(0,255,179,.15), inset 0 0 18px rgba(0,255,179,.4);
    outline: 5px solid var(--ring);
    filter: drop-shadow(0 0 20px rgba(0,255,179,.35));
  }
  .wheel{
    width:var(--size); height:var(--size); border-radius:50%;
    background: conic-gradient(
      #0aa8ff 0deg 72deg,       /* 1 */
      #c8f2ff 72deg 144deg,     /* 2 */
      #0f87c7 144deg 216deg,    /* 3 */
      #ff2c6f 216deg 288deg,    /* حظ أوفر */
      #1db8a9 288deg 360deg     /* 0 */
    );
    transition: transform 4.2s cubic-bezier(.18,.85,.24,1);
    position:relative;
  }
  /* ليبلات القطاعات */
  .wheel .label{
    position:absolute; left:50%; top:50%;
    transform-origin: center;
    font-weight:800; color:#fff; text-shadow:0 2px 6px rgba(0,0,0,.55);
  }
  .wheel .label span{ display:inline-block; transform: translate(-50%,-50%); }

  /* تموضع كل ليبل عند مركز القطاع */
  /* 5 قطاعات => كل 72° . نحرك كل ليبل بزاويته و نبعده لنص القطر */
  .w-l0{ transform: rotate(36deg) translate(calc(var(--size)/2.6)) rotate(-36deg); }   /* 1 */
  .w-l1{ transform: rotate(36+72deg) translate(calc(var(--size)/2.6)) rotate(-(36+72deg)); } /* 2 */
  .w-l2{ transform: rotate(36+144deg) translate(calc(var(--size)/2.6)) rotate(-(36+144deg)); }/* 3 */
  .w-l3{ transform: rotate(36+216deg) translate(calc(var(--size)/2.6)) rotate(-(36+216deg)); }/* حظ أوفر */
  .w-l4{ transform: rotate(36+288deg) translate(calc(var(--size)/2.6)) rotate(-(36+288deg)); }/* 0 */

  .badge-big{ font-size:38px }
  .badge-mid{ font-size:34px }

  /* السهم لتــحت */
  .pointer{
    position:absolute; left:50%; bottom:-18px; transform:translateX(-50%) rotate(180deg);
    width:0; height:0;
    border-left:14px solid transparent; border-right:14px solid transparent;
    border-top:22px solid #ff004c;
    filter: drop-shadow(0 0 8px rgba(255,0,76,.6));
  }

  .cta{ display:flex; justify-content:center; margin:16px 0 6px }
  button{
    background: linear-gradient(90deg,#00d18f,#00a8ff);
    border:none; color:#fff; font-weight:800; font-size:18px;
    padding:12px 20px; border-radius:999px; cursor:pointer;
    box-shadow:0 14px 32px rgba(0,168,255,.25); transition: transform .12s ease, filter .12s ease;
  }
  button:disabled{ filter:grayscale(.6) brightness(.75); cursor:not-allowed }
  button:not(:disabled):active{ transform: translateY(1px) scale(.99) }

  .info{
    margin-top:8px; background:rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.08);
    border-radius:14px; padding:12px; text-align:center; color:var(--muted)
  }
  .info strong{ color:#fff }
  .pill{
    display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
    background:rgba(255,255,255,.08); font-weight:800; color:#fff; margin-inline:6px;
  }
  .ok{color:#63ff9c}
  .result{
    margin-top:14px; font-size:20px; text-align:center; font-weight:800
  }
  .result.win{ color:#63ff9c }
  .result.lose{ color:#ffd166 }
  .tiny{font-size:12px; opacity:.9; margin-top:6px}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Fly Express — <span style="color:#27ff92">عجلة</span></h1>
    <div class="sub"><span class="icon">🎡</span>الحظ</div>

    <div class="card">
      <div class="wheel-box">
        <div class="ring" aria-hidden="true"></div>

        <div id="wheel" class="wheel" role="img" aria-label="عجلة الجوائز">
          <!-- ليبلات القطاعات -->
          <div class="label w-l0"><span class="badge-mid">1</span></div>
          <div class="label w-l1"><span class="badge-mid">2</span></div>
          <div class="label w-l2"><span class="badge-mid">3</span></div>
          <div class="label w-l3"><span class="badge-big">حظ أوفر</span></div>
          <div class="label w-l4"><span class="badge-mid">0</span></div>
        </div>

        <div class="pointer" aria-hidden="true"></div>
      </div>

      <div class="cta"><button id="spinBtn">🎯 لف العجلة</button></div>

      <div class="info">
        لديك <span class="pill"><strong id="left">0</strong> محاولات</span>.
        تتجدد المحاولات كل <strong>خميس</strong>.<br>
        <span class="tiny">اليوم الخميس — تم فتح المحاولات لهذا الأسبوع <span id="isThu" class="ok">✓</span></span>
      </div>

      <div id="out" class="result"></div>
    </div>
  </div>

<script>
/* ========= الإعدادات ========= */
const PRIZES = [
  {label:'1', value:1},
  {label:'2', value:2},
  {label:'3', value:3},
  {label:'حظ أوفر', value:'lose'},
  {label:'0', value:0},
];
// ترتيب القطاعات = نفس ترتيب conic-gradient بالأعلى
// كل قطاع 72°، ومركزه كل (36° + 72°*i)

const urlParams = new URLSearchParams(location.search);
const DEBUG = urlParams.get('debug') === '1';  // ?debug=1 يعطي 99 محاولة

const wheel = document.getElementById('wheel');
const btn   = document.getElementById('spinBtn');
const leftEl= document.getElementById('left');
const out   = document.getElementById('out');
const isThu = document.getElementById('isThu');

/* ========= إدارة الخميس والمحاولات ========= */
function thursdayKeyFor(d=new Date()){
  // احسب تاريخ الخميس لهذا الاسبوع
  const day = d.getDay();          // 0=الأحد .. 6=السبت
  const diffToThu = ((4 - day) + 7) % 7; // 4 = الخميس
  const th = new Date(d.getFullYear(), d.getMonth(), d.getDate() + diffToThu);
  const yyyy = th.getFullYear();
  const mm = String(th.getMonth()+1).padStart(2,'0');
  const dd = String(th.getDate()).padStart(2,'0');
  return `${yyyy}-${mm}-${dd}`;
}

function loadQuota(){
  if (DEBUG){
    localStorage.setItem('spins_left','99');
    localStorage.setItem('spin_thursday_key', thursdayKeyFor());
  }

  const currentKey = thursdayKeyFor();
  const savedKey = localStorage.getItem('spin_thursday_key');
  let left = Number(localStorage.getItem('spins_left') || 0);

  if (savedKey !== currentKey){
    left = 2; // محاولتان جديدتان
    localStorage.setItem('spin_thursday_key', currentKey);
    localStorage.setItem('spins_left', String(left));
  }
  updateUI(left);
  return left;
}

function updateUI(left){
  leftEl.textContent = left;
  btn.disabled = left <= 0;
  const todayKey = thursdayKeyFor(new Date());
  const savedKey = localStorage.getItem('spin_thursday_key');
  isThu.style.visibility = (savedKey === todayKey) ? 'visible' : 'hidden';
}

function setLeft(n){
  localStorage.setItem('spins_left', String(n));
  updateUI(n);
}

/* ========= دوران العجلة ========= */
let spinning = false;

function spin(){
  if (spinning) return;
  let left = Number(localStorage.getItem('spins_left') || 0);
  if (left <= 0){ out.textContent = 'لا توجد محاولات متبقية.'; out.className='result'; return; }

  spinning = true; btn.disabled = true; out.textContent=''; out.className='result';

  const idx = Math.floor(Math.random()*PRIZES.length); // 0..4
  // زاوية مركز القطاع المستهدف:
  // مركز القطاع i = 36° + 72°*i
  const targetMid = 36 + 72*idx;

  // لأن السهم لتحت => +90°
  const turns = 6; // للفات كثيرة شكلها أحلى
  const finalDeg = (turns*360) + targetMid + 90;

  wheel.style.transform = `rotate(${finalDeg}deg)`;

  // بعد نهاية الأنيميشن
  setTimeout(()=>{
    spinning = false;
    left -= 1; setLeft(left); // استهلك محاولة

    const res = PRIZES[idx];
    if (res.value === 'lose'){
      out.textContent = 'حظ أوفر! جرّب المرة الجاية 👀';
      out.className = 'result lose';
    }else{
      out.textContent = `مبروك! كسبت ${res.value} توصيلات مجانية 🎉`;
      out.className = 'result win';
    }
    btn.disabled = left <= 0;
  }, 4300);
}

/* ========= تشغيل ========= */
btn.addEventListener('click', spin);
loadQuota();
</script>
</body>
</html>
