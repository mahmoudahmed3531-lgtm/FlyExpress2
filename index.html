<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Fly Express — عجلة الحظ</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --neon:#00ffaa; --neon2:#12b5ff;
  }
  *{box-sizing:border-box}
  body{
    margin:0;min-height:100dvh;font-family:'Cairo',system-ui,sans-serif;color:#e9f3fa;
    background:
      radial-gradient(1100px 600px at 15% 15%, #0b1a27 0%, transparent 60%),
      radial-gradient(1100px 600px at 85% 85%, #081420 0%, transparent 60%),
      linear-gradient(160deg,#06131c,#081b27 60%,#06131c);
  }
  .wrap{max-width:720px;margin:0 auto;padding:22px}
  h1{text-align:center;margin:10px 0 18px;font-size:32px;letter-spacing:.2px}
  h1 span{color:var(--neon)}
  .board{
    margin:0 auto;background:rgba(255,255,255,.03);
    border:1px solid rgba(255,255,255,.06);backdrop-filter:blur(8px);
    border-radius:22px;padding:22px;box-shadow:0 18px 40px rgba(0,0,0,.35)
  }

  .stage{position:relative;width:360px;height:360px;margin:0 auto}
  /* العجلة */
  .wheel{
    position:relative;
    width:100%;height:100%;border-radius:50%;
    border:10px solid var(--neon);
    box-shadow:0 0 24px rgba(0,255,170,.35), inset 0 0 28px rgba(18,181,255,.25);
    background:
      conic-gradient(
        #0ea5e9 0deg 72deg,      /* 1 */
        #a5f3fc 72deg 144deg,    /* 2 */
        #0b61a4 144deg 216deg,   /* 3 */
        #ff1f64 216deg 288deg,   /* حظ أوفر */
        #0aa2a4 288deg 360deg    /* 0 */
      );
    transition:transform 6s cubic-bezier(.17,.8,.23,1.02);
    overflow:hidden;
  }
  /* لابيل كل شريحة */
  .slice-label{
    position:absolute;left:50%;top:50%;
    transform-origin:50% 50%;
    font-weight:800;font-size:26px;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.45);
    pointer-events:none; /* علشان ما تمنع الضغط */
  }
  /* سهم ثابت فوق وباصص لداخل العجلة */
  .pointer{
    position:absolute;left:50%;top:-18px;transform:translateX(-50%);
    width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;
    border-bottom:22px solid #ff004c;filter:drop-shadow(0 0 8px rgba(255,0,76,.55));
  }

  .btn{
    margin:18px auto 0;display:block;cursor:pointer;border:0;
    padding:12px 24px;border-radius:999px;font-weight:800;font-size:18px;
    color:#012430;background:linear-gradient(90deg,var(--neon),var(--neon2));
    box-shadow:0 14px 28px rgba(0,255,170,.25);transition:transform .12s ease,opacity .12s ease;
  }
  .btn:hover{transform:translateY(-2px)}
  .btn:disabled{opacity:.55;cursor:not-allowed}

  .info{margin-top:14px;text-align:center;color:#bcd1de;font-weight:700}
  .badge{display:inline-block;margin-top:6px;padding:6px 12px;border-radius:999px;
    background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.09)}
  .result{margin-top:16px;text-align:center;font-size:20px;font-weight:800}
  .win{color:#00ffaa;text-shadow:0 0 12px rgba(0,255,170,.45)}
  .lose{color:#ff7aa6;text-shadow:0 0 10px rgba(255,0,100,.35)}
</style>
</head>
<body>
  <div class="wrap">
    <h1><span>عجلة</span> — Fly Express <span>الحظ</span> 🎡</h1>

    <div class="board">
      <div class="stage">
        <div id="wheel" class="wheel"></div>
        <div class="pointer"></div>
      </div>

      <button id="spinBtn" class="btn">🎯 لف العجلة</button>

      <div class="info">
        لديك <span id="left" class="badge">–</span> محاولات. تتجدد المحاولات كل <b>خميس</b>.
        <div id="thNote" style="margin-top:6px"></div>
      </div>

      <div id="result" class="result"></div>
    </div>
  </div>

<script>
(() => {
  // الشرائح (وِفق ترتيب ألوان الـ conic-gradient)
  const slices = ["1","2","3","حظ أوفر","0"];
  const arc = 360 / slices.length;   // 72°
  const wheel = document.getElementById('wheel');

  // نرسم لابيل لكل شريحة عند منتصفها
  // نصف قطر النص ≈ 140px (360/2 - حدود)
  const radius = 140;
  slices.forEach((label, i) => {
    const mid = i * arc + arc/2;         // زاوية منتصف الشريحة
    const el = document.createElement('div');
    el.className = 'slice-label';
    el.textContent = label;
    // نخلي النص دائمًا مستقيم: ندور للنقطة وبعدين نعمل translate للخارج ثم نلغي الدوران
    el.style.transform = `rotate(${mid}deg) translateY(-${radius}px) rotate(${-mid}deg)`;
    wheel.appendChild(el);
  });

  const spinBtn = document.getElementById('spinBtn');
  const resultEl = document.getElementById('result');
  const leftEl = document.getElementById('left');
  const thNote = document.getElementById('thNote');

  // — المحاولات: 2 وتتجدد كل خميس —
  function thursdayKeyFor(date=new Date()){
    const d = new Date(date); d.setHours(0,0,0,0);
    const dayMon0 = (d.getDay()+6)%7; // Mon=0
    const monday = new Date(d); monday.setDate(d.getDate()-dayMon0);
    const thursday = new Date(monday); thursday.setDate(monday.getDate()+3);
    return thursday.toISOString().slice(0,10);
  }
  const KEY='spin_thursday_key', LEFT='spins_left';

  function loadQuota(){
    const currentKey = thursdayKeyFor();
    const savedKey = localStorage.getItem(KEY);
    let left = Number(localStorage.getItem(LEFT) || 0);
    if (savedKey !== currentKey){ left=2; localStorage.setItem(KEY,currentKey); }
    localStorage.setItem(LEFT,String(left));
    updateUI(left); return left;
  }
  function saveQuota(l){ localStorage.setItem(LEFT,String(l)); updateUI(l); }
  function updateUI(l){
    leftEl.textContent = l;
    const isThu = (new Date().getDay()===4);
    thNote.textContent = isThu? "اليوم الخميس — تم فتح المحاولات لهذا الأسبوع ✅"
                              : "ستتجدد المحاولات تلقائيًا يوم الخميس القادم ⏳";
    spinBtn.disabled = (l<=0);
  }

  let spinsLeft = loadQuota();
  let busy=false;

  function spin(){
    if(busy) return;
    if(spinsLeft<=0){ resultEl.innerHTML="<span class='lose'>⚠️ خلصت محاولاتك — استنى الخميس القادم</span>"; return; }
    busy=true; spinBtn.disabled=true; resultEl.textContent="";

    // اختيار شريحة عشوائيًا
    const idx = Math.floor(Math.random()*slices.length);
    const targetMid = idx*arc + arc/2;
    const turns = 6; // شكل
    const finalDeg = (turns*360) + targetMid - 90; // -90 لأن السهم بالأعلى

    wheel.style.transform = `rotate(${finalDeg}deg)`;

    setTimeout(()=>{
      const label = slices[idx];
      let msg="";
      if(label==="حظ أوفر"){
        msg = "<span class='lose'>😔 حظ أوفر! جرب تاني</span>";
      }else{
        const n = Number(label);
        const word = (n===1)? "توصيلة" : "توصيلات";
        msg = `<span class='win'>🎉 مبروك! كسبت ${n} ${word} مجانية</span>`;
      }
      resultEl.innerHTML = msg;

      spinsLeft = Math.max(0,spinsLeft-1);
      saveQuota(spinsLeft);
      busy=false;
    }, 6100);
  }
  spinBtn.addEventListener('click', spin);
})();
</script>
</body>
</html>
