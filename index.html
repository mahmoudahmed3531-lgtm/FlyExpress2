<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Whack-a-Parcel â€” Fly Express</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root{
    --glass: rgba(255,255,255,.06);
    --card: rgba(255,255,255,.08);
    --muted:#b8c0c9;
    --ok:#00ffaa;
    --warn:#ffd166;
    --bad:#ff4d7a;
    --title:#21f5b3;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:'Cairo',system-ui,sans-serif; color:#eaf1f6;
    min-height:100svh; display:flex; align-items:center; justify-content:center; padding:22px;
    background:
      radial-gradient(1100px 600px at 10% 10%, #062133 0%, transparent 65%),
      radial-gradient(1100px 600px at 90% 90%, #00131c 0%, transparent 65%),
      conic-gradient(from 0deg at 50% 50%, #021018, #07273a, #031c2b, #021018);
    background-size:140% 140%,140% 140%,200% 200%;
    animation: bg1 16s ease-in-out infinite, bg2 18s ease-in-out infinite, hue 32s linear infinite;
  }
  @keyframes bg1{0%,100%{background-position:10% 10%,90% 90%,0% 50%}50%{background-position:30% 20%,70% 80%,100% 50%}}
  @keyframes bg2{0%,100%{background-position:10% 10%,90% 90%,0% 50%}50%{background-position:15% 25%,85% 75%,100% 50%}}
  @keyframes hue{0%{filter:hue-rotate(0)}100%{filter:hue-rotate(360deg)}}

  .frame{
    width:100%; max-width:820px; border-radius:24px; padding:22px;
    background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08);
    box-shadow:0 18px 50px rgba(0,0,0,.28), inset 0 0 0 1px rgba(255,255,255,.05);
  }
  h1{
    margin:0 0 10px; font-size:34px; font-weight:900; color:#fff; text-align:center;
  }
  h1 .brand{color:var(--title)}
  .sub{margin:6px auto 18px; text-align:center; color:#cfe2ee}
  .stats{display:flex; gap:12px; justify-content:space-between; flex-wrap:wrap}
  .stat{
    flex:1 1 160px; background:var(--glass); border:1px solid rgba(255,255,255,.08);
    padding:12px 14px; border-radius:16px; text-align:center; box-shadow:0 10px 24px rgba(0,0,0,.25);
  }
  .stat .v{font-size:22px; font-weight:900}
  .stat .k{font-size:13px; color:var(--muted)}

  .board{
    margin-top:14px; background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.07);
    border-radius:18px; padding:16px;
  }
  .row{display:grid; grid-template-columns:repeat(3,1fr); gap:14px}
  .hole{
    position:relative; height:140px; border-radius:18px;
    background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.35));
    border:1px solid rgba(255,255,255,.07);
    box-shadow: inset 0 14px 28px rgba(0,0,0,.35), 0 14px 32px rgba(0,0,0,.3);
    overflow:hidden; touch-action:none;
  }
  .target{
    position:absolute; left:50%; bottom:-120px; transform:translateX(-50%);
    width:86px; height:86px; border-radius:18px; line-height:86px; text-align:center; font-size:40px;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.25), rgba(255,255,255,.05));
    border:1px solid rgba(255,255,255,.15);
    box-shadow: 0 12px 26px rgba(0,0,0,.35);
    transition: bottom .12s ease, transform .12s ease;
    user-select:none;
  }
  .target.up{ bottom:22px; }
  .target.hit{ animation: pop .18s ease; }
  @keyframes pop{0%{transform:translateX(-50%) scale(1)}50%{transform:translateX(-50%) scale(1.1)}100%{transform:translateX(-50%) scale(1)}}
  .hole.shake{ animation: shake .18s ease; }
  @keyframes shake{0%,100%{transform:translateX(0)}50%{transform:translateX(2px)}}

  .actions{display:flex; gap:12px; justify-content:center; margin:14px 0 4px}
  .btn{
    background:linear-gradient(90deg,#00ffaa,#00a8ff); color:#001316; font-weight:900;
    padding:10px 18px; border:none; border-radius:999px; cursor:pointer;
    box-shadow:0 10px 28px rgba(0,255,170,.28); transition:transform .1s ease; font-size:16px;
  }
  .btn:active{transform:translateY(1px)}
  .btn.secondary{background:linear-gradient(90deg,#d3f3ff,#b4ffd0); color:#003b35}
  .btn:disabled{opacity:.6; cursor:not-allowed}

  .result{margin:12px 0 4px; text-align:center; font-weight:900}
  .result.win{color:var(--ok)} .result.lose{color:var(--bad)}

  /* Overlay Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© */
  #overlay{
    position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.5); backdrop-filter: blur(3px); z-index:30;
  }
  .startBox{
    background:rgba(10,20,28,.9); border:1px solid rgba(255,255,255,.08); border-radius:18px; padding:22px; text-align:center;
    box-shadow:0 24px 50px rgba(0,0,0,.45); width:min(420px,92vw);
  }
  #cd{font-size:42px; font-weight:900; margin-top:10px; color:#fff}

  /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© Ø¨Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© */
  #claimBox{display:none; gap:10px; justify-content:center; margin-top:10px}
  .note{color:var(--muted); text-align:center; font-weight:700; margin-top:6px}

  @media(max-width:520px){
    .hole{height:120px} .target{width:78px;height:78px;line-height:78px;font-size:36px}
  }
</style>
</head>
<body>

<div class="frame">
  <h1><span class="brand">Fly Express</span> â€” Whack-a-Parcel</h1>
  <div class="sub">Ø§Ø¶Ø±Ø¨ Ø§Ù„Ø·Ø±Ø¯ Ø§Ù„ØµØ­ <b>(+100)</b> ÙˆØªØ¬Ù†Ù‘Ø¨ Ø§Ù„Ù…Ø²ÙŠÙ <b>(âˆ’50)</b>. Ø¹Ù†Ø¯Ùƒ <b>30 Ø«Ø§Ù†ÙŠØ©</b>. Ø§Ù„Ù‡Ø¯Ù: <b>4000+</b> Ù†Ù‚Ø·Ø© ğŸ</div>

  <div class="stats">
    <div class="stat"><div class="v" id="time">30</div><div class="k">Ø§Ù„ÙˆÙ‚Øª (Ø«)</div></div>
    <div class="stat"><div class="v" id="score">0</div><div class="k">Ø§Ù„Ù†Ù‚Ø§Ø·</div></div>
    <div class="stat"><div class="v" id="best">0</div><div class="k">Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©</div></div>
    <div class="stat"><button class="btn" id="startBtn">Ø§Ø¨Ø¯Ø£ ğŸš€</button></div>
  </div>

  <div class="board">
    <div class="row">
      <div class="hole"><div class="target">ğŸ“¦</div></div>
      <div class="hole"><div class="target">ğŸ“¦</div></div>
      <div class="hole"><div class="target">ğŸ“¦</div></div>

      <div class="hole"><div class="target">ğŸ“¦</div></div>
      <div class="hole"><div class="target">ğŸ“¦</div></div>
      <div class="hole"><div class="target">ğŸ“¦</div></div>

      <div class="hole"><div class="target">ğŸ“¦</div></div>
      <div class="hole"><div class="target">ğŸ“¦</div></div>
      <div class="hole"><div class="target">ğŸ“¦</div></div>
    </div>

    <div class="actions">
      <button class="btn secondary" id="infoBtn">Ø¥Ø²Ø§ÙŠ Ø£ÙƒØ³Ø¨ØŸ</button>
      <button class="btn" id="beginBtn" style="display:none">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
    </div>

    <div id="claimBox">
      <a class="btn" id="waBtn" href="#" target="_blank" rel="noopener">Ø§Ø·Ù„Ø¨ Ø¬Ø§Ø¦Ø²ØªÙƒ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ ğŸ</a>
    </div>

    <div id="final" class="result"></div>
    <div class="note">Ù†ØµÙŠØ­Ø©: Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ÙØªØ­Ø© ÙØ§Ø¶ÙŠØ© ÙŠØ®ØµÙ… Ù†Ù‚Ø§Ø·!</div>
  </div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
<div id="overlay">
  <div class="startBox">
    <div style="font-weight:900;font-size:22px;margin-bottom:6px">Ø¬Ø§Ù‡Ø² ØªØ¨Ø¯Ø£ØŸ</div>
    <div style="color:#cfe2ee">Ù‡ÙŠØ¸Ù‡Ø± Ø¹Ø¯Ø§Ø¯ 3..1.. Ø§Ù†Ø·Ù„Ù‚ â€” ÙØ¹Ù‘Ù„ Ø§Ù„ØµÙˆØª Ù„Ùˆ ØªØ­Ø¨ ØªØ£Ø«ÙŠØ±Ø§Øª!</div>
    <div id="cd">3</div>
    <div style="margin-top:12px">
      <button class="btn" id="goBtn">Ø§Ø¨Ø¯Ø£</button>
    </div>
  </div>
</div>

<script>
/* ========= Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ========= */
const GAME_DURATION = 30;        // Ù…Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
const WIN_THRESHOLD = 4000;      // Ø§Ù„Ø´Ø±Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„ÙÙˆØ²

// Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø±Ø¨
const GOOD_SCORE = 100;
const BAD_SCORE  = -50;
const EMPTY_TAP_PENALTY = -30;   // Ø®ØµÙ… Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·Ø© ÙÙŠ ÙØªØ­Ø© ÙØ§Ø¶ÙŠØ©

// Ù…Ù†Ø­Ù†ÙŠØ§Øª Ø§Ù„ØµØ¹ÙˆØ¨Ø© (Ø¨ØªØ²ÙŠØ¯ ÙƒÙ„ Ù…Ø§ Ø§Ù„ÙˆÙ‚Øª ÙŠÙ‚Ù„)
const DIFF = {
  baseSpawn: 480,     // Ù…ÙŠÙ„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© Ø¨ÙŠÙ† Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø³Ø¨ÙˆÙ† ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
  minSpawn:  240,     // Ø£Ù‚Ù„ Ø²Ù…Ù† Ø³Ø¨ÙˆÙ† ÙÙŠ Ø¢Ø®Ø± Ø§Ù„Ù„Ø¹Ø¨Ø©
  baseVisible: 650,   // Ù…Ø¯Ø© Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù‡Ø¯Ù Ø¸Ø§Ù‡Ø± ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
  minVisible: 300,    // Ø£Ù‚Ù„ Ù…Ø¯Ø© Ø¨Ù‚Ø§Ø¡ ÙÙŠ Ø¢Ø®Ø± Ø§Ù„Ù„Ø¹Ø¨Ø©
  badStart: 0.25,     // Ù†Ø³Ø¨Ø© Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
  badEnd:   0.55,     // Ù†Ø³Ø¨Ø© Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„ ÙÙŠ Ø¢Ø®Ø± Ø§Ù„Ù„Ø¹Ø¨Ø©
  maxConcurrentStart: 1,
  maxConcurrentEnd:   3,
  shrinkStart: 1.00,  // Ø­Ø¬Ù… Ø§Ù„Ù‡Ø¯Ù ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (scale)
  shrinkEnd:   0.82,  // Ø¨ÙŠØµØºØ± Ø´ÙˆÙŠØ© ÙÙŠ Ø§Ù„Ø¢Ø®Ø±
  graceMs: 150        // Ù…Ù‡Ù„Ø© Ø§Ù„Ø£Ù…Ø§Ù† Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªÙØ§Ø¡
};

/* ========= Ø¹Ù†Ø§ØµØ± DOM ========= */
const holes   = [...document.querySelectorAll(".hole")];
const scoreEl = document.querySelector("#score");
const bestEl  = document.querySelector("#best");
const timeEl  = document.querySelector("#time");
const overlay = document.querySelector("#overlay");
const startBtn= document.querySelector("#startBtn");
const beginBtn= document.querySelector("#beginBtn");
const goBtn   = document.querySelector("#goBtn");
const cdEl    = document.querySelector("#cd");
const finalEl = document.querySelector("#final");
const claimBox= document.querySelector("#claimBox");
const waBtn   = document.querySelector("#waBtn");
const infoBtn = document.querySelector("#infoBtn");

/* ========= ØµÙˆØªÙŠØ§Øª Ø¨Ø³ÙŠØ·Ø© ========= */
let ctx, AC, outGain;
function audioInit(){ if(ctx) return;
  AC = window.AudioContext||window.webkitAudioContext; if(!AC) return;
  ctx = new AC(); outGain = ctx.createGain(); outGain.gain.value=.18; outGain.connect(ctx.destination);
}
function beep(f=800,d=.08,t="square"){ if(!ctx) return;
  const o=ctx.createOscillator(), g=ctx.createGain();
  o.type=t; o.frequency.value=f; o.connect(g); g.connect(outGain);
  const s=ctx.currentTime; g.gain.setValueAtTime(.0001,s);
  g.gain.exponentialRampToValueAtTime(.6,s+.01);
  g.gain.exponentialRampToValueAtTime(.0001,s+d);
  o.start(s); o.stop(s+d+.01);
}

/* ========= Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ========= */
let score=0, best=parseInt(localStorage.getItem("wap_best")||"0");
let playing=false, timeLeft=GAME_DURATION;
let spawnLoop, tickTimer;
bestEl.textContent = best;

/* ========= ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙØªØ­Ø§Øª ========= */
holes.forEach(h=>{
  const t=h.querySelector(".target");
  t.dataset.state="down"; t.dataset.kind="good";
  t.dataset.hit="0"; t.dataset.graceUntil="0";

  const hit = (kind)=>{
    if(kind==="good"){ score+=GOOD_SCORE; beep(920,.07,"square"); }
    else{ score=Math.max(0,score+BAD_SCORE); h.classList.add("shake"); beep(180,.12,"sawtooth"); setTimeout(()=>h.classList.remove("shake"),250); }
    scoreEl.textContent=score;
  };

  // Ø¶ØºØ·Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø¯Ù
  const onTap = (e)=>{
    e.preventDefault(); if(!playing) return;
    const wasUp = t.dataset.state==="up" || Date.now()<+t.dataset.graceUntil;
    if(!wasUp) return;
    if(t.dataset.hit==="1") return;
    t.dataset.hit="1";
    t.dataset.state="down"; t.classList.remove("up");
    t.classList.add("hit"); setTimeout(()=>t.classList.remove("hit"),180);
    setTimeout(()=>t.dataset.hit="0",10);
    hit(t.dataset.kind);
  };

  // Ø¶ØºØ·Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙØªØ­Ø© Ù†ÙØ³Ù‡Ø§ (Ù„Ùˆ ÙØ§Ø¶ÙŠØ© Ù†Ø®ØµÙ…)
  const onHoleTap = (e)=>{
    if(!playing) return;
    if(t.dataset.state!=="up" && Date.now()>+t.dataset.graceUntil){
      score=Math.max(0,score+EMPTY_TAP_PENALTY);
      scoreEl.textContent=score;
      h.classList.add("shake"); beep(220,.08,"triangle");
      setTimeout(()=>h.classList.remove("shake"),180);
    } else {
      onTap(e);
    }
  };

  t.addEventListener("pointerdown", onTap);
  h.addEventListener("pointerdown", onHoleTap);
});

/* ========= ØµØ¹ÙˆØ¨Ø© Ù…ØªØ¯Ø±Ø¬Ø© ========= */
const prog = ()=> 1 - (timeLeft/GAME_DURATION); // 0 â†’ 1
function difficultyNow(){
  const p = prog();
  return {
    spawn:   Math.round( DIFF.baseSpawn   - (DIFF.baseSpawn - DIFF.minSpawn)*p ),
    visible: Math.round( DIFF.baseVisible - (DIFF.baseVisible - DIFF.minVisible)*p ),
    badRate: DIFF.badStart + (DIFF.badEnd - DIFF.badStart)*p,
    maxConcurrent: Math.round( DIFF.maxConcurrentStart + (DIFF.maxConcurrentEnd - DIFF.maxConcurrentStart)*p ),
    scale: DIFF.shrinkStart - (DIFF.shrinkStart - DIFF.shrinkEnd)*p
  };
}

function spawnLoopTick(){
  if(!playing) return;
  const {spawn, visible, badRate, maxConcurrent, scale} = difficultyNow();

  // ÙƒØ§Ù… Ù‡Ø¯Ù Ø¸Ø§Ù‡Ø± Ø§Ù„Ø¢Ù†ØŸ
  const ups = holes.filter(h=>h.querySelector(".target").dataset.state==="up");
  const canSpawn = Math.max(0, maxConcurrent - ups.length);

  for(let i=0; i<canSpawn; i++){
    const downHoles = holes.filter(h=>h.querySelector(".target").dataset.state==="down");
    if(!downHoles.length) break;
    const h = downHoles[Math.floor(Math.random()*downHoles.length)];
    const t = h.querySelector(".target");

    const isBad = Math.random() < badRate;
    t.dataset.kind = isBad ? "bad" : "good";
    t.textContent  = isBad ? "ğŸ’£" : "ğŸ“¦";
    t.style.transform = `translateX(-50%) scale(${scale})`;

    t.dataset.hit="0";
    t.dataset.state="up";
    t.classList.add("up");

    setTimeout(()=>{
      if(t.dataset.state==="up"){
        t.dataset.state="down";
        t.classList.remove("up");
        t.dataset.graceUntil = String(Date.now()+DIFF.graceMs);
        setTimeout(()=>{ t.dataset.hit="0"; t.dataset.graceUntil="0"; }, DIFF.graceMs+30);
      }
    }, visible);
  }

  spawnLoop = setTimeout(spawnLoopTick, spawn);
}

/* ========= Ø¨Ø¯Ø§ÙŠØ©/Ù†Ù‡Ø§ÙŠØ© ========= */
function startGame(){
  if(playing) return;
  playing = true;
  score = 0; timeLeft = GAME_DURATION;
  scoreEl.textContent="0"; timeEl.textContent=timeLeft;
  finalEl.textContent=""; finalEl.className="result"; claimBox.style.display="none";

  spawnLoopTick();
  tickTimer = setInterval(()=>{
    timeLeft--; timeEl.textContent=timeLeft;
    if(timeLeft<=0) endGame();
  },1000);
}

function endGame(){
  clearTimeout(spawnLoop); clearInterval(tickTimer); playing=false;
  best = Math.max(best, score); localStorage.setItem("wap_best", best); bestEl.textContent=best;

  if(score>=WIN_THRESHOLD){
    finalEl.textContent=`ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø¯Ø±Ø¬ØªÙƒ ${score} â€” ØªÙ‚Ø¯Ø± ØªØ·Ù„Ø¨ Ø¬Ø§Ø¦Ø²ØªÙƒ ğŸ`;
    finalEl.classList.add("win");
    const msg=encodeURIComponent(`Ø£Ù†Ø§ ÙƒØ³Ø¨Øª ØªÙˆØµÙŠÙ„Ù‡ Ù…Ø¬Ø§Ù†ÙŠØ© ÙÙŠ Ù„Ø¹Ø¨Ø© Whack-a-Parcel â€” Ø¯Ø±Ø¬ØªÙŠ: ${score}`);
    waBtn.href=`https://wa.me/201017908076?text=${msg}`; claimBox.style.display="flex";
    beep(660,.12,"sine"); setTimeout(()=>beep(990,.14,"sine"),120);
  } else {
    finalEl.textContent=`Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø¯Ø±Ø¬ØªÙƒ: ${score} â€” Ù…Ø¹Ù„Ø´ Ø­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ ÙŠÙ…ÙƒÙ† ØªÙƒØ³Ø¨ ğŸ˜‚`;
    finalEl.classList.add("lose"); beep(180,.14,"sawtooth");
  }
}

/* ========= ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ========= */
startBtn.addEventListener("click",()=>{
  if(playing) return;
  overlay.style.display="grid";
  beginBtn.style.display="inline-block";
  document.querySelector("#cd").style.display="none";
});
beginBtn.addEventListener("click",()=>{
  audioInit();
  beginBtn.style.display="none";
  document.querySelector("#cd").style.display="block";
  let n=3; cdEl.textContent=n;
  const iv=setInterval(()=>{
    n--; cdEl.textContent = n>0 ? n : "Ø§Ù†Ø·Ù„Ù‚!";
    if(n<=0){ clearInterval(iv); setTimeout(()=>{ overlay.style.display="none"; startGame(); },300); }
  },700);
});
goBtn.addEventListener("click",()=>{ overlay.style.display="none"; startGame(); });

["pointerdown","touchstart","click"].forEach(ev=>addEventListener(ev,audioInit,{once:true}));
document.addEventListener("touchmove",e=>{ if(playing) e.preventDefault(); },{passive:false});

infoBtn.addEventListener("click",()=>{
  alert("Ø§Ø¶Ø±Ø¨ ğŸ“¦ +100 ÙˆØªØ¬Ù†Ù‘Ø¨ ğŸ’£ âˆ’50. Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ÙØªØ­Ø© ÙØ§Ø¶ÙŠØ© âˆ’30. Ø¹Ù†Ø¯Ùƒ 30 Ø«Ø§Ù†ÙŠØ© â€” Ø­Ø§ÙˆÙ„ ØªØ¹Ø¯Ù‘ÙŠ 4000 Ù†Ù‚Ø·Ø©!");
});
</script>
</body>
</html>
