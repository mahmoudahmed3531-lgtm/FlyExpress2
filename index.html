<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fly Express â€” Whack-a-Parcel</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800;900&display=swap" rel="stylesheet">
<style>
  :root{
    --wrap-max: 560px;          /* Ø£Ù‚ØµÙ‰ Ø¹Ø±Ø¶ Ù„Ù„ÙƒØ§Ø±Øª */
    --board-min: 250px;         /* Ø£Ù‚Ù„ Ø¹Ø±Ø¶ Ù„Ù„ÙˆØ­Ø© */
    --board-max: 360px;         /* Ø£ÙƒØ¨Ø± Ø¹Ø±Ø¶ Ù„Ù„ÙˆØ­Ø© */
    --gap-min: 10px;
    --gap-max: 16px;
    --pad-min: 10px;
    --pad-max: 16px;
    --brand: #8a5cf6;
    --accent: #00ffae;
    --danger: #ff4d7a;
    --muted: #9fb2c7;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:'Cairo',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    color:#eaf2fb;
    background:
      radial-gradient(800px 400px at 10% 10%, #0e2231 0%, transparent 60%),
      radial-gradient(900px 500px at 90% 100%, #041822 0%, transparent 60%),
      conic-gradient(from 0deg, #021017, #031a25, #072a3c, #031a25, #021017);
    background-size:140% 140%,140% 140%,200% 200%;
    animation:move1 18s ease-in-out infinite, move2 20s ease-in-out infinite, hue 36s linear infinite;
  }
  @keyframes move1 {0%,100%{background-position:10% 10%, 90% 100%, 0% 50%} 50%{background-position:25% 15%, 75% 85%, 100% 50%}}
  @keyframes move2 {0%,100%{background-position:10% 10%, 90% 100%, 0% 50%} 50%{background-position:15% 25%, 85% 75%, 100% 50%}}
  @keyframes hue   {0%{filter:hue-rotate(0)}100%{filter:hue-rotate(360deg)}}

  .wrap{max-width:var(--wrap-max); margin:22px auto; padding:0 14px}
  .card{
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 22px;
    box-shadow: 0 18px 50px rgba(0,0,0,.28);
    overflow: hidden;
  }

  header{padding:18px 18px 6px}
  header h1{
    margin:0 0 6px;
    font-size: clamp(24px, 6vw, 38px);
    font-weight: 900;
    letter-spacing:.2px;
  }
  header h1 .fx{color:var(--brand)}
  header p{
    margin:6px 0 0;
    color:var(--muted);
    font-weight:700;
    font-size: clamp(13px, 3.4vw, 16px);
  }

  .stats{display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; padding:12px 14px 0}
  .stat{
    background: rgba(0,0,0,.22);
    border:1px solid rgba(255,255,255,.06);
    border-radius:16px; padding:12px; text-align:center;
  }
  .stat .v{font-size: clamp(20px,5.8vw,28px); font-weight:900}
  .stat .k{font-size:12px; color:var(--muted); margin-top:4px}

  .game-wrap{max-width:var(--wrap-max); margin-inline:auto; padding:12px 14px 18px}
  .board{
    width: clamp(var(--board-min), 92vw, var(--board-max));
    aspect-ratio: 1/1;
    margin: 10px auto 14px;
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap: clamp(var(--gap-min), 2.6vw, var(--gap-max));
    padding: clamp(var(--pad-min), 2.6vw, var(--pad-max));
    background: rgba(0,0,0,.28);
    border:1px solid rgba(255,255,255,.08);
    border-radius:18px;
    box-shadow: inset 0 10px 24px rgba(0,0,0,.35);
  }
  .cell{
    position:relative;
    height:auto; aspect-ratio:1/1;
    border-radius:18px;
    background:linear-gradient(180deg,#0f1d28,#0a141c);
    border:1px solid rgba(255,255,255,.05);
    overflow:hidden;
  }
  .item{
    position:absolute; inset:8%;
    border-radius:14px;
    display:flex; align-items:center; justify-content:center; text-align:center;
    font-weight:900;
    letter-spacing:.3px;
    box-shadow:0 10px 24px rgba(0,0,0,.35);
    user-select:none;
    -webkit-tap-highlight-color: transparent;
  }
  .parcel{ background:linear-gradient(180deg,#1cc5a6,#0aa07f); color:#032c27; }
  .bomb  { background:linear-gradient(180deg,#ff6a95,#ff316b); color:#2e0713; }
  .bonus { background:linear-gradient(180deg,#53a6ff,#1d7cff); color:#041a33; }

  .item .emoji{font-size: clamp(22px, 8vw, 28px)}
  .item .pts  {font-size: clamp(12px, 3.8vw, 14px); opacity:.85}

  .controls{display:flex; gap:10px; justify-content:center; padding:8px 14px 18px}
  .btn{
    border:none; cursor:pointer; font-weight:900;
    color:#051016; background:linear-gradient(90deg,#ff73e1,#ffb5e8);
    padding: clamp(10px, 2.8vw, 14px) clamp(16px, 4vw, 22px);
    border-radius:18px; box-shadow:0 10px 26px rgba(0,0,0,.35);
  }
  .btn.secondary{background:linear-gradient(90deg,#bfffe9,#8bf7d4)}
  .btn:disabled{opacity:.6; cursor:not-allowed}

  .goal{padding:0 14px 18px; text-align:center; color:var(--muted); font-weight:800}
  .goal strong{color:#fff}

  .toast{
    margin: 8px auto 16px; max-width:var(--wrap-max);
    text-align:center; font-weight:900;
    color:#ffd1dc; display:none;
  }
  .toast.show{display:block}

  footer{padding:14px; text-align:center; color:#9fb2c7; font-size:12px}

  @media (max-width:340px){
    :root{ --board-min: 220px; }
    .cell{ border-radius:14px }
  }
</style>
</head>
<body>

<div class="wrap">
  <div class="card">
    <header>
      <h1><span class="fx">Fly Express</span> â€” Whack-a-Parcel</h1>
      <p>Ø§Ø¶Ø±Ø¨ Ø§Ù„Ø·Ø±Ø¯ Ø§Ù„ØµØ­ <b>(+100)</b> ÙˆØªØ¬Ù†Ø¨ Ø§Ù„Ù…Ø²ÙŠÙ <b>(âˆ’50)</b> ÙˆØ®Ø¯ Ø¨Ø§Ù„Ùƒ Ù…Ù† Ø§Ù„Ø¨ÙˆÙ†Øµ! Ø¹Ù†Ø¯Ùƒ <b>30 Ø«Ø§Ù†ÙŠØ©</b>. <span style="color:#ffd166">Ø§Ù„Ù‡Ø¯Ù: +4000 Ù†Ù‚Ø·Ø©</span> ğŸ</p>
    </header>

    <div class="stats">
      <div class="stat"><div class="v" id="time">0</div><div class="k">Ø§Ù„ÙˆÙ‚Øª (Ø«)</div></div>
      <div class="stat"><div class="v" id="score">0</div><div class="k">Ø§Ù„Ù†Ù‚Ø§Ø·</div></div>
      <div class="stat"><div class="v" id="best">0</div><div class="k">Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©</div></div>
    </div>

    <div class="game-wrap">
      <div class="board" id="board">
        <!-- 9 Ø®Ù„Ø§ÙŠØ§ -->
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
      </div>

      <div class="controls">
        <button class="btn" id="startBtn">ğŸš€ Ø§Ø¨Ø¯Ø£</button>
        <button class="btn secondary" id="howBtn">ØŸ Ø¥Ø²Ø§ÙŠ Ø£ÙƒØ³Ø¨</button>
      </div>

      <div class="goal">Ù†ØµÙŠØ­Ø©: Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ ÙØªØ­Ø© ÙØ§Ø¶ÙŠØ© ÙŠØ®ØªÙÙŠ Ø§Ù„Ø¹Ù†ØµØ± Ø£Ø³Ø±Ø¹. Ù‡Ø¯ÙÙƒ <strong>4000+</strong> Ù†Ù‚Ø·Ø©.</div>
      <div class="toast" id="toast"></div>
    </div>
  </div>

  <footer>Â© Fly Express</footer>
</div>

<script>
  // Ø§Ù„Ø¹Ù†Ø§ØµØ±
  const board   = document.getElementById('board');
  const cells   = Array.from(board.querySelectorAll('.cell'));
  const startBtn= document.getElementById('startBtn');
  const howBtn  = document.getElementById('howBtn');
  const timeEl  = document.getElementById('time');
  const scoreEl = document.getElementById('score');
  const bestEl  = document.getElementById('best');
  const toast   = document.getElementById('toast');

  // Ø§Ù„Ø­Ø§Ù„Ø©
  let running = false;
  let timeLeft = 30;
  let score = 0;
  let best = Number(localStorage.getItem('fx_best')||0);
  bestEl.textContent = best.toString();

  // ØªØ§ÙŠÙ…Ø±Ø²
  let tickTimer = null;   // Ù„ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
  let spawnTimer = null;  // Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„Ø¹Ù†Ø§ØµØ±
  let difficultyTimer = null; // Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø©

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµØ¹ÙˆØ¨Ø©
  let spawnInterval = 650;       // ÙƒÙ„ ÙƒÙ… Ù…Ù„Ù‘ÙŠ Ø«Ø§Ù†ÙŠØ© Ù†Ø­Ø¯Ù‘Ø« Ø§Ù„Ø£Ù‡Ø¯Ø§Ù (Ø£Ù‚Ù„ = Ø£ØµØ¹Ø¨)
  let itemLifetime  = 900;       // ÙƒÙ… Ù…Ù„Ù‘ÙŠ Ø«Ø§Ù†ÙŠØ© ÙŠØ®ØªÙÙŠ Ø¨Ø¹Ø¯Ù‡Ø§ Ø§Ù„Ù‡Ø¯Ù Ù„Ùˆ Ù…ØªØ¶ØºØ·Ø´
  let maxActive     = 3;         // Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯ Ø¹Ù†Ø§ØµØ± Ù…Ø±Ø¦ÙŠØ© ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù„Ø­Ø¸Ø©
  const goalScore   = 4000;

  // Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ù‚ØµÙŠØ±
  const hitCooldown = 180; // ms

  // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
  const rpick = arr => arr[Math.floor(Math.random()*arr.length)];
  const nowms = () => performance.now();

  // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø©
  function showToast(msg, color='#ffd1dc'){
    toast.textContent = msg;
    toast.style.color = color;
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 1600);
  }

  // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
  function reset(){
    running = false;
    timeLeft = 30;
    score = 0;
    spawnInterval = 650;
    itemLifetime  = 900;
    maxActive = 3;
    timeEl.textContent = '0';
    scoreEl.textContent = '0';
    clearTimers();
    clearCells();
    startBtn.disabled = false;
  }

  // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¹Ù†Ø§ØµØ±
  function clearCells(){
    cells.forEach(c=>{
      c.innerHTML = '';
      c.dataset.locked = '';
    });
  }
  function clearTimers(){
    [tickTimer, spawnTimer, difficultyTimer].forEach(t=>{ if(t) clearInterval(t); });
    tickTimer=spawnTimer=difficultyTimer=null;
  }

  // ØªÙˆÙ„ÙŠØ¯ Ø¹Ù†ØµØ± Ø¹Ø´ÙˆØ§Ø¦ÙŠ
  function createItem(){
    // Ø£Ù†ÙˆØ§Ø¹ ÙˆÙ†ÙØ³Ø¨: Ø·Ø±Ø¯ 62%ØŒ Ù‚Ù†Ø¨Ù„Ø© 26%ØŒ Ø¨ÙˆÙ†Øµ 12%
    const roll = Math.random();
    let kind = 'parcel';
    if(roll>0.74 && roll<=0.88) kind='bomb';
    else if(roll>0.88) kind='bonus';

    const el = document.createElement('div');
    el.className = `item ${kind}`;
    el.innerHTML = kind==='parcel'
      ? `<div><div class="emoji">ğŸ“¦</div><div class="pts">+100</div></div>`
      : kind==='bomb'
        ? `<div><div class="emoji">ğŸ’£</div><div class="pts">âˆ’50</div></div>`
        : `<div><div class="emoji">âš¡ï¸</div><div class="pts">+150</div></div>`;

    el.dataset.kind = kind;
    el.dataset.born = nowms();

    // Ù„Ù…Ø³/Ù†Ù‚Ø±: Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø­Ø³Ø§Ø¨Ø©
    let tapped = false;
    const onTap = (ev)=>{
      ev.stopPropagation();
      if(tapped) return;
      tapped = true;

      // Ù‚ÙÙ„ Ø§Ù„Ø®Ù„ÙŠØ© Ù„Ø­Ø¸ÙŠÙ‹Ø§ Ù„ØªØ¬Ù†Ø¨ double tap
      const parent = el.parentElement;
      parent.dataset.locked = '1';

      if(kind==='parcel')      score += 100;
      else if(kind==='bomb')   score -= 50;
      else                     score += 150;

      scoreEl.textContent = score.toString();

      // ÙÙ„Ø§Ø´ Ø¨Ø³ÙŠØ·
      el.style.transform='scale(.9)';
      el.style.filter='brightness(1.15)';
      setTimeout(()=>{ if(el.parentElement) el.parentElement.removeChild(el); parent.dataset.locked=''; }, hitCooldown);
    };

    el.addEventListener('click', onTap, {passive:true});
    el.addEventListener('touchstart', onTap, {passive:true});

    return el;
  }

  // ÙƒÙ… Ø¹Ù†ØµØ± Ø¸Ø§Ù‡Ø± Ø­Ø§Ù„ÙŠÙ‹Ø§ØŸ
  function activeCount(){
    return cells.reduce((acc,c)=> acc + (c.firstElementChild?1:0), 0);
  }

  // Ø³Ø¨ÙˆÙ†/Ø¥Ø®ÙØ§Ø¡ Ø¯ÙˆØ±ÙŠ
  function loopSpawn(){
    if(!running) return;
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Ø§Ù†ØªÙ‡Ù‰ Ø¹Ù…Ø±Ù‡Ø§)
    const t = nowms();
    cells.forEach(c=>{
      const it = c.firstElementChild;
      if(!it) return;
      const born = Number(it.dataset.born||t);
      if(t - born > itemLifetime){
        // Ù„Ù…Ø³Ø© Ø¹Ù„Ù‰ ÙØ±Ø§Øº: Ø­Ø§ÙØ² ØµØºÙŠØ± ÙŠØ®Ù„ÙŠÙ‡Ø§ ØªØ®ØªÙÙŠ Ø£Ø³Ø±Ø¹ Ù„Ùˆ Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„ÙØ§Ø¶ÙŠØ©
        c.addEventListener('click', ()=>{ if(c.firstElementChild===it) c.removeChild(it); }, {once:true, passive:true});
        c.removeChild(it);
      }
    });

    // Ù„Ùˆ ØªØ­Øª Ø§Ù„Ø­Ø¯ØŒ Ø£Ø¶Ù Ø¹Ù†Ø§ØµØ± Ø¬Ø¯ÙŠØ¯Ø©
    const room = Math.max(0, maxActive - activeCount());
    for(let i=0;i<room;i++){
      const emptyCells = cells.filter(c => !c.firstElementChild && !c.dataset.locked);
      if(!emptyCells.length) break;
      const slot = rpick(emptyCells);
      slot.appendChild(createItem());
    }
  }

  // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø© ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§
  function bumpDifficulty(){
    // ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ: Ø£Ø³Ø±Ø¹ + Ø£Ø¹Ù…Ø§Ø± Ø£Ù‚ØµØ± + Ø§Ø­ØªÙ…Ø§Ù„ Ø¹Ù†Ø§ØµØ± Ø£ÙƒØ«Ø± Ù…Ø¹Ù‹Ø§
    spawnInterval = Math.max(360, spawnInterval - 40);
    itemLifetime  = Math.max(550, itemLifetime - 35);
    if(maxActive < 5) maxActive += 1;

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ø³Ø¨ÙˆÙ†
    if(spawnTimer) clearInterval(spawnTimer);
    spawnTimer = setInterval(loopSpawn, spawnInterval);
  }

  // Ø§Ù„Ø¹Ø¯Ù‘Ø§Ø¯
  function tick(){
    if(!running) return;
    timeLeft--;
    timeEl.textContent = timeLeft.toString();
    if(timeLeft<=0){
      endGame();
    }
  }

  // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬ÙˆÙ„Ø©
  function endGame(){
    running=false;
    clearTimers();
    clearCells();
    startBtn.disabled = false;

    if(score > best){
      best = score;
      localStorage.setItem('fx_best', String(best));
      bestEl.textContent = best.toString();
    }

    if(score >= goalScore){
      showToast(`ğŸ‰ Ø¬Ø§Ù…Ø¯! Ø¹Ø¯Ù‘ÙŠØª Ø§Ù„Ù‡Ø¯Ù (${goalScore}+). Ù†ØªÙŠØ¬ØªÙƒ: ${score}`, '#9effc7');
    }else{
      showToast(`Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø¯Ø±Ø¬ØªÙƒ: ${score} â€” Ù…Ø¹Ù„Ø´ Ø­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ ÙŠÙ…ÙƒÙ† ØªÙƒØ³Ø¨ ğŸ˜‚`, '#ffd1dc');
    }
  }

  // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
  function start(){
    reset();
    running = true;
    startBtn.disabled = true;

    timeLeft = 30;
    timeEl.textContent = timeLeft.toString();
    score = 0;
    scoreEl.textContent = '0';

    // Ù…Ø¨Ø¯Ø¦ÙŠÙ‹Ø§ Ø³Ø¨ÙˆÙ†
    loopSpawn();
    spawnTimer = setInterval(loopSpawn, spawnInterval);
    tickTimer  = setInterval(tick, 1000);
    difficultyTimer = setInterval(bumpDifficulty, 5000);
  }

  // Ø£Ø­Ø¯Ø§Ø«
  startBtn.addEventListener('click', start);
  howBtn.addEventListener('click', ()=>{
    showToast('ğŸ“Œ Ø§Ù„Ø·Ø±Ø¯ +100ØŒ Ø§Ù„Ù‚Ù†Ø¨Ù„Ø© âˆ’50ØŒ Ø§Ù„Ø¨ÙˆÙ†Øµ +150 â€” Ø§Ù„Ù‡Ø¯Ù 4000+', '#bfe9ff');
  });

  // Ø¬Ø§Ù‡Ø²ÙŠØ© Ø£ÙˆÙ„ÙŠØ©
  reset();
</script>
</body>
</html>
