<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fly Express — عجلة الحظ</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap" rel="stylesheet">

<style>
:root{
  --ring:#00ffaa;
  --bg:#06131d;
}
body{
  margin:0;
  font-family:'Cairo',sans-serif;
  background: radial-gradient(circle at top left,#071a25 0%,#010b10 100%);
  color:#fff;
  text-align:center;
}
h1{margin:20px 0 10px;font-size:30px}
h1 span{color:#00ffaa}

.container{
  max-width:400px;
  margin:auto;
  padding:15px;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.08);
  border-radius:15px;
  box-shadow:0 0 25px rgba(0,255,170,.15);
}

#wheel-area{position:relative;display:flex;justify-content:center;align-items:center;margin:20px 0;}
#wheel{
  width:280px;height:280px;border-radius:50%;
  border:8px solid var(--ring);
  background:conic-gradient(
    #0aa8ff 0deg 72deg,
    #7cd9ff 72deg 144deg,
    #0f6dc2 144deg 216deg,
    #ff2c6f 216deg 288deg,
    #1db8a9 288deg 360deg
  );
  transition:transform 5s cubic-bezier(.17,.8,.25,1.02);
}
.pointer{
  position:absolute;left:50%;bottom:-18px;transform:translateX(-50%) rotate(180deg);
  width:0;height:0;
  border-left:14px solid transparent;
  border-right:14px solid transparent;
  border-top:22px solid #ff004c;
  filter:drop-shadow(0 0 8px rgba(255,0,76,.6));
}

/* النصوص فوق العجلة */
.labels{
  position:absolute;left:50%;top:50%;
  width:0;height:0;pointer-events:none;
}
.label{
  position:absolute;transform-origin:center center;
  font-weight:900;font-size:22px;text-shadow:0 2px 6px #000;
}

/* مواقع النصوص */
.l1{transform:rotate(36deg) translate(110px) rotate(-36deg);}
.l2{transform:rotate(108deg) translate(110px) rotate(-108deg);}
.l3{transform:rotate(180deg) translate(110px) rotate(-180deg);}
.l4{transform:rotate(252deg) translate(110px) rotate(-252deg);}
.l5{transform:rotate(324deg) translate(110px) rotate(-324deg);}

button{
  background:linear-gradient(90deg,#00ffaa,#00a8ff);
  border:none;
  color:#000;
  font-weight:900;
  font-size:18px;
  padding:10px 20px;
  border-radius:30px;
  cursor:pointer;
  box-shadow:0 6px 20px rgba(0,255,170,.3);
}
button:disabled{opacity:.6;cursor:not-allowed}

.info{margin-top:12px;font-weight:700;font-size:15px;color:#cbd5e1;}
.note{margin-top:6px;font-weight:800}
.note.ok{color:#00ffaa}
.note.warn{color:#ffd166}
.result{margin-top:15px;font-weight:900;font-size:20px;}
.win{color:#00ffaa;}
.lose{color:#ff5c8a;}
</style>
</head>
<body>
<h1><span>عجلة الحظ</span> — Fly Express 🎡</h1>

<div class="container">
  <div id="wheel-area">
    <div id="wheel"></div>
    <div class="pointer"></div>
    <div class="labels">
      <div class="label l1">1</div>
      <div class="label l2">2</div>
      <div class="label l3">3</div>
      <div class="label l4">حظ أوفر</div>
      <div class="label l5">0</div>
    </div>
  </div>

  <button id="spinBtn">🎯 لف العجلة</button>

  <div class="info">لديك <span id="left">0</span> محاولات، تتجدد كل <b>خميس</b>.</div>
  <div id="note" class="note"></div>

  <div id="result" class="result"></div>
</div>

<script>
const wheel = document.getElementById("wheel");
const result = document.getElementById("result");
const spinBtn = document.getElementById("spinBtn");
const leftEl = document.getElementById("left");
const noteEl = document.getElementById("note");

const sectors = ["1","2","3","حظ أوفر","0"];
let isSpinning=false;

function getThursdayKey(){
  const d=new Date();const day=d.getDay();const diff=(4-day+7)%7;
  const th=new Date(d.getFullYear(),d.getMonth(),d.getDate()+diff);
  return th.toISOString().split('T')[0];
}
const DEBUG = location.search.includes("debug=1");

function todayIsThursday(){ return new Date().getDay()===4; }

function updateNote(left){
  noteEl.className='note';
  if(left>0){
    noteEl.textContent=''; // مفيش رسالة تحذير
    return;
  }
  if(todayIsThursday()){
    noteEl.textContent='خلصت محاولاتك لهذا الأسبوع ✅';
    noteEl.classList.add('ok');
  }else{
    noteEl.textContent='محاولاتك خلصت — جرب الخميس الجاي ✨';
    noteEl.classList.add('warn');
  }
}

function loadChances(){
  if(DEBUG){localStorage.setItem("chances","99");localStorage.setItem("key",getThursdayKey());}
  const cur=getThursdayKey();
  const saved=localStorage.getItem("key");
  let left=+localStorage.getItem("chances")||0;
  if(saved!==cur){left=2;localStorage.setItem("key",cur);}
  localStorage.setItem("chances",left);
  leftEl.textContent=left;
  spinBtn.disabled=left<=0;
  updateNote(left);
  return left;
}
function saveChances(n){
  localStorage.setItem("chances",n);
  leftEl.textContent=n;
  spinBtn.disabled=n<=0;
  updateNote(n);
}
let left=loadChances();

function spin(){
  if(isSpinning||left<=0)return;
  isSpinning=true;spinBtn.disabled=true;result.textContent="";

  const idx=Math.floor(Math.random()*sectors.length);
  const degPer=360/sectors.length;
  const mid=degPer*idx + degPer/2;
  const finalDeg= (6*360) + mid + 90; // +90 لأن السهم لتحت
  wheel.style.transform=`rotate(${finalDeg}deg)`;

  setTimeout(()=>{
    const val=sectors[idx];
    left--;saveChances(left);
    if(val==="حظ أوفر"){
      result.innerHTML="😔 <span class='lose'>حظ أوفر! جرب تاني</span>";
    }else{
      result.innerHTML=`🎉 <span class='win'>مبروك! كسبت ${val} توصيلات مجانية</span>`;
    }
    isSpinning=false;
  },5200);
}
spinBtn.addEventListener("click",spin);
</script>
</body>
</html>
