<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fly Express â€” Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap" rel="stylesheet">
<style>
  body{margin:0;font-family:'Cairo',sans-serif;background:radial-gradient(circle at top left,#071a25 0%,#010b10 100%);color:#fff;text-align:center}
  h1{margin:20px 0 10px;font-size:30px} h1 span{color:#00ffaa}
  .container{max-width:420px;margin:auto;padding:15px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);border-radius:15px;box-shadow:0 0 25px rgba(0,255,170,.15)}
  #wheel-area{position:relative;margin:25px auto;width:300px;height:300px}
  #wheelCanvas{width:100%;height:100%;border:8px solid #00ffaa;border-radius:50%;box-shadow:0 0 20px rgba(0,255,170,.4);background:#06131d}
  .pointer{position:absolute;left:50%;bottom:-18px;transform:translateX(-50%) rotate(180deg);width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;border-top:22px solid #ff004c;filter:drop-shadow(0 0 8px rgba(255,0,76,.6))}
  button{background:linear-gradient(90deg,#00ffaa,#00a8ff);border:none;color:#000;font-weight:900;font-size:18px;padding:10px 20px;border-radius:30px;cursor:pointer;box-shadow:0 6px 20px rgba(0,255,170,.3)}
  button:disabled{opacity:.6;cursor:not-allowed}
  .info{margin-top:12px;font-weight:700;font-size:15px;color:#cbd5e1}
  .note{margin-top:6px;font-weight:800}.note.ok{color:#00ffaa}.note.warn{color:#ffd166}
  .result{margin-top:15px;font-weight:900;font-size:20px}.win{color:#00ffaa}.lose{color:#ff5c8a}
</style>
</head>
<body>
<h1><span>Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</span> â€” Fly Express ğŸ¡</h1>

<div class="container">
  <div id="wheel-area">
    <canvas id="wheelCanvas" width="300" height="300"></canvas>
    <div class="pointer"></div>
  </div>

  <button id="spinBtn">ğŸ¯ Ù„Ù Ø§Ù„Ø¹Ø¬Ù„Ø©</button>

  <div class="info">Ù„Ø¯ÙŠÙƒ <span id="left">0</span> Ù…Ø­Ø§ÙˆÙ„Ø§ØªØŒ ØªØªØ¬Ø¯Ø¯ ÙƒÙ„ <b>Ø®Ù…ÙŠØ³</b>.</div>
  <div id="note" class="note"></div>
  <div id="result" class="result"></div>
</div>

<script>
const canvas = document.getElementById("wheelCanvas");
const ctx = canvas.getContext("2d");
const spinBtn = document.getElementById("spinBtn");
const result = document.getElementById("result");
const leftEl = document.getElementById("left");
const noteEl = document.getElementById("note");

const sectors = ["1","2","3","Ø­Ø¸ Ø£ÙˆÙØ±","0"];
const colors  = ["#0aa8ff","#7cd9ff","#0f6dc2","#ff2c6f","#1db8a9"];

let rotation = 0;             // Ø²Ø§ÙˆÙŠØ© Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ø¹Ø¬Ù„Ø© (Ø±Ø§Ø¯ÙŠØ§Ù†)
let isSpinning = false;

function drawWheel(){
  const n = sectors.length;
  const arc = 2*Math.PI / n;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=0;i<n;i++){
    const start = i*arc + rotation;
    ctx.beginPath();
    ctx.moveTo(150,150);
    ctx.arc(150,150,140,start,start+arc);
    ctx.fillStyle = colors[i];
    ctx.fill();

    // ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù†Øµ ÙƒØ¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø¹Ø¬Ù„Ø© (Ø¨ÙŠØªØ­Ø±Ùƒ Ù…Ø¹Ø§Ù‡Ø§)
    ctx.save();
    ctx.translate(150,150);
    ctx.rotate(start + arc/2);
    ctx.textAlign = "right";
    ctx.fillStyle = "#fff";
    ctx.font = "bold 22px Cairo";
    ctx.fillText(sectors[i],120,8);
    ctx.restore();
  }
}

// Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø®Ù…ÙŠØ³ + Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
function getThursdayKey(){ const d=new Date(),diff=(4-d.getDay()+7)%7,th=new Date(d.getFullYear(),d.getMonth(),d.getDate()+diff); return th.toISOString().split('T')[0]; }
function todayIsThursday(){ return new Date().getDay()===4; }
const DEBUG = location.search.includes("debug=1");

function updateNote(left){
  noteEl.className='note';
  if(left>0){ noteEl.textContent=''; return; }
  if(todayIsThursday()){ noteEl.textContent='Ø®Ù„ØµØª Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ âœ…'; noteEl.classList.add('ok'); }
  else { noteEl.textContent='Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ Ø®Ù„ØµØª â€” Ø¬Ø±Ø¨ Ø§Ù„Ø®Ù…ÙŠØ³ Ø§Ù„Ø¬Ø§ÙŠ âœ¨'; noteEl.classList.add('warn'); }
}
function loadChances(){
  if(DEBUG){ localStorage.setItem("chances","99"); localStorage.setItem("key",getThursdayKey()); }
  const cur = getThursdayKey();
  const saved = localStorage.getItem("key");
  let left = +localStorage.getItem("chances") || 0;
  if(saved !== cur){ left = 10; localStorage.setItem("key",cur); }
  localStorage.setItem("chances", left);
  leftEl.textContent = left;
  spinBtn.disabled = left<=0;
  updateNote(left);
  return left;
}
function saveChances(n){
  localStorage.setItem("chances",n);
  leftEl.textContent = n;
  spinBtn.disabled = n<=0;
  updateNote(n);
}
let left = loadChances();

// Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø³Ù‡Ù… Ø§Ù„Ø«Ø§Ø¨Øª: Ø£Ø³ÙÙ„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© = Ï€/2
const POINTER_ANGLE = Math.PI/2;

function spin(){
  if(isSpinning || left<=0) return;
  isSpinning = true; spinBtn.disabled = true; result.textContent = "";

  const spins = 5 + Math.random()*5;               // Ø¹Ø¯Ø¯ Ø§Ù„Ù„ÙØ§Øª Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
  const finalAngle = rotation + spins * (2*Math.PI);
  const duration = 4000;
  const start = performance.now();

  function animate(now){
    const t = Math.min((now - start)/duration, 1);
    const easeOut = 1 - Math.pow(1 - t, 3);
    rotation = (finalAngle * easeOut) % (2*Math.PI);
    drawWheel();
    if(t<1){ requestAnimationFrame(animate); }
    else{
      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø³Ù‡Ù… Ù…Ù†Ø³ÙˆØ¨Ø© Ù„Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ø¹Ø¬Ù„Ø©
      const n   = sectors.length;
      const arc = 2*Math.PI / n;
      const rel = (POINTER_ANGLE - (rotation % (2*Math.PI)) + 2*Math.PI) % (2*Math.PI); // Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø³Ù‡Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¹Ø¬Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
      const index = Math.floor(rel / arc) % n;   // Ø§Ù„Ù‚Ø·Ø§Ø¹ ØªØ­Øª Ø§Ù„Ø³Ù‡Ù…

      const val = sectors[index];
      left--; saveChances(left);

      if(val === "Ø­Ø¸ Ø£ÙˆÙØ±"){
        result.innerHTML = "ğŸ˜” <span class='lose'>Ø­Ø¸ Ø£ÙˆÙØ±! Ø¬Ø±Ø¨ ØªØ§Ù†ÙŠ</span>";
      }else{
        result.innerHTML = `ğŸ‰ <span class='win'>Ù…Ø¨Ø±ÙˆÙƒ! ÙƒØ³Ø¨Øª ${val} ØªÙˆØµÙŠÙ„Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ©</span>`;
      }
      isSpinning = false;
    }
  }
  requestAnimationFrame(animate);
}

drawWheel();
spinBtn.addEventListener("click", spin);
</script>
</body>
</html>
