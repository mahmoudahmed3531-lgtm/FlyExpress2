<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fly Express — Whack-a-Parcel</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800;900&display=swap" rel="stylesheet">
<style>
  :root{
    --wrap-max: 560px;          /* أقصى عرض للكارت */
    --board-min: 250px;         /* أقل عرض للوحة */
    --board-max: 360px;         /* أكبر عرض للوحة */
    --gap-min: 10px;
    --gap-max: 16px;
    --pad-min: 10px;
    --pad-max: 16px;
    --brand: #8a5cf6;
    --accent: #00ffae;
    --muted: #9fb2c7;
    --danger:#ff4d7a;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:'Cairo',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    color:#eaf2fb;
    background:
      radial-gradient(800px 400px at 10% 10%, #0e2231 0%, transparent 60%),
      radial-gradient(900px 500px at 90% 100%, #041822 0%, transparent 60%),
      conic-gradient(from 0deg, #021017, #031a25, #072a3c, #031a25, #021017);
    background-size:140% 140%,140% 140%,200% 200%;
    animation:move1 18s ease-in-out infinite, move2 20s ease-in-out infinite, hue 36s linear infinite;
  }
  @keyframes move1 {0%,100%{background-position:10% 10%, 90% 100%, 0% 50%} 50%{background-position:25% 15%, 75% 85%, 100% 50%}}
  @keyframes move2 {0%,100%{background-position:10% 10%, 90% 100%, 0% 50%} 50%{background-position:15% 25%, 85% 75%, 100% 50%}}
  @keyframes hue   {0%{filter:hue-rotate(0)}100%{filter:hue-rotate(360deg)}}

  .wrap{max-width:var(--wrap-max); margin:22px auto; padding:0 14px}
  .card{
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 22px;
    box-shadow: 0 18px 50px rgba(0,0,0,.28);
    overflow: hidden;
  }

  header{padding:18px 18px 6px}
  header h1{margin:0 0 6px; font-size:clamp(24px, 6vw, 38px); font-weight:900}
  header h1 .fx{color:var(--brand)}
  header p{margin:6px 0 0; color:var(--muted); font-weight:700; font-size:clamp(13px,3.4vw,16px)}

  .stats{display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; padding:12px 14px 0}
  .stat{background: rgba(0,0,0,.22); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:12px; text-align:center}
  .stat .v{font-size:clamp(20px,5.8vw,28px); font-weight:900}
  .stat .k{font-size:12px; color:var(--muted); margin-top:4px}

  .game-wrap{max-width:var(--wrap-max); margin-inline:auto; padding:12px 14px 18px}
  .board{
    width: clamp(var(--board-min), 92vw, var(--board-max));
    aspect-ratio: 1/1;
    margin: 10px auto 14px;
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap: clamp(var(--gap-min), 2.6vw, var(--gap-max));
    padding: clamp(var(--pad-min), 2.6vw, var(--pad-max));
    background: rgba(0,0,0,.28);
    border:1px solid rgba(255,255,255,.08);
    border-radius:18px;
    box-shadow: inset 0 10px 24px rgba(0,0,0,.35);
  }
  .cell{
    position:relative;
    height:auto; aspect-ratio:1/1;
    border-radius:18px;
    background:linear-gradient(180deg,#0f1d28,#0a141c);
    border:1px solid rgba(255,255,255,.05);
    overflow:hidden;
  }

  /* عناصر اللعبة */
  .item{
    position:absolute; inset:8%;
    border-radius:14px;
    display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center;
    font-weight:900; letter-spacing:.3px;
    box-shadow:0 10px 24px rgba(0,0,0,.35);
    user-select:none; -webkit-tap-highlight-color: transparent;
    animation: pop-in .18s ease-out both;
  }
  .parcel{ background:linear-gradient(180deg,#1cc5a6,#0aa07f); color:#032c27; }
  .bomb  { background:linear-gradient(180deg,#ff6a95,#ff316b); color:#2e0713; }
  .bonus { background:linear-gradient(180deg,#53a6ff,#1d7cff); color:#041a33; }

  .item .emoji{font-size:clamp(22px, 8vw, 28px)}
  .item .pts  {font-size:clamp(12px, 3.8vw, 14px); opacity:.85}

  /* انيميشن الطلوع/النزول */
  @keyframes pop-in   { from{ transform:translateY(18px) scale(.92); opacity:.0 } to{ transform:translateY(0) scale(1); opacity:1 } }
  @keyframes pop-out  { from{ transform:translateY(0) scale(1);   opacity:1 }   to{ transform:translateY(18px) scale(.92); opacity:.0 } }
  .pop-out{ animation: pop-out .16s ease-in forwards }

  .controls{display:flex; gap:10px; justify-content:center; padding:8px 14px 18px}
  .btn{border:none; cursor:pointer; font-weight:900; color:#051016; background:linear-gradient(90deg,#ff73e1,#ffb5e8);
       padding:clamp(10px,2.8vw,14px) clamp(16px,4vw,22px); border-radius:18px; box-shadow:0 10px 26px rgba(0,0,0,.35)}
  .btn.secondary{background:linear-gradient(90deg,#bfffe9,#8bf7d4)}
  .btn:disabled{opacity:.6; cursor:not-allowed}

  .goal{padding:0 14px 18px; text-align:center; color:var(--muted); font-weight:800}
  .goal strong{color:#fff}

  .toast{margin:8px auto 16px; max-width:var(--wrap-max); text-align:center; font-weight:900; color:#ffd1dc; display:none}
  .toast.show{display:block}

  footer{padding:14px; text-align:center; color:#9fb2c7; font-size:12px}

  @media (max-width:340px){
    :root{ --board-min: 220px }
    .cell{ border-radius:14px }
  }
</style>
</head>
<body>

<div class="wrap">
  <div class="card">
    <header>
      <h1><span class="fx">Fly Express</span> — Whack-a-Parcel</h1>
      <p>اضرب الطرد الصح <b>(+100)</b> وتجنب المزيف <b>(−50)</b> وخد بالك من البونص! عندك <b>30 ثانية</b>. <span style="color:#ffd166">الهدف: +4000 نقطة</span> 🎁</p>
    </header>

    <div class="stats">
      <div class="stat"><div class="v" id="time">0</div><div class="k">الوقت (ث)</div></div>
      <div class="stat"><div class="v" id="score">0</div><div class="k">النقاط</div></div>
      <div class="stat"><div class="v" id="best">0</div><div class="k">أعلى نتيجة</div></div>
    </div>

    <div class="game-wrap">
      <div class="board" id="board">
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
      </div>

      <div class="controls">
        <button class="btn" id="startBtn">🚀 ابدأ</button>
        <button class="btn secondary" id="howBtn">؟ إزاي أكسب</button>
      </div>

      <div class="goal">نصيحة: اضغط على فتحة فاضية يختفي العنصر أسرع. هدفك <strong>4000+</strong> نقطة.</div>
      <div class="toast" id="toast"></div>
    </div>
  </div>

  <footer>© Fly Express</footer>
</div>

<script>
  // عناصر DOM
  const board   = document.getElementById('board');
  const cells   = Array.from(board.querySelectorAll('.cell'));
  const startBtn= document.getElementById('startBtn');
  const howBtn  = document.getElementById('howBtn');
  const timeEl  = document.getElementById('time');
  const scoreEl = document.getElementById('score');
  const bestEl  = document.getElementById('best');
  const toast   = document.getElementById('toast');

  // حالة اللعبة
  let running = false;
  let timeLeft = 30;
  let score = 0;
  let best = Number(localStorage.getItem('fx_best')||0);
  bestEl.textContent = best.toString();

  // تايمرز
  let tickTimer = null;
  let spawnTimer = null;
  let difficultyTimer = null;

  // صعوبة (زي النسخة اللي عجبتك) + responsive sizing من النسخة الأخيرة
  let spawnInterval = 650;  // سرعتها تزيد تدريجياً
  let itemLifetime  = 900;  // أقل = أصعب
  let maxActive     = 3;    // يزيد تدريجياً لحد 5
  const goalScore   = 4000;

  const hitCooldown = 180; // منع الدبل-تاب سريع

  const rpick = arr => arr[Math.floor(Math.random()*arr.length)];
  const nowms = () => performance.now();

  function showToast(msg, color='#ffd1dc'){
    toast.textContent = msg;
    toast.style.color = color;
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 1600);
  }

  function reset(){
    running=false; timeLeft=30; score=0;
    spawnInterval=650; itemLifetime=900; maxActive=3;
    timeEl.textContent='0'; scoreEl.textContent='0';
    clearTimers(); clearCells(); startBtn.disabled=false;
  }
  function clearCells(){ cells.forEach(c=>{ c.innerHTML=''; c.dataset.locked=''; }); }
  function clearTimers(){ [tickTimer,spawnTimer,difficultyTimer].forEach(t=>t&&clearInterval(t)); tickTimer=spawnTimer=difficultyTimer=null; }

  // عنصر جديد + انيميشن الطلوع/النزول
  function createItem(){
    const roll=Math.random();
    let kind='parcel';                        // 62%
    if(roll>0.74 && roll<=0.88) kind='bomb';  // 14%
    else if(roll>0.88) kind='bonus';          // 12%

    const el=document.createElement('div');
    el.className=`item ${kind}`;
    el.innerHTML = kind==='parcel'
      ? `<div class="emoji">📦</div><div class="pts">+100</div>`
      : kind==='bomb'
        ? `<div class="emoji">💣</div><div class="pts">−50</div>`
        : `<div class="emoji">⚡️</div><div class="pts">+150</div>`;
    el.dataset.kind=kind;
    el.dataset.born=nowms();

    let tapped=false;
    const onTap=(ev)=>{
      ev.stopPropagation();
      if(tapped) return; tapped=true;
      const parent=el.parentElement; parent.dataset.locked='1';

      if(kind==='parcel') score+=100;
      else if(kind==='bomb') score-=50;
      else score+=150;

      scoreEl.textContent=String(score);
      // انيميشن خروج
      el.classList.add('pop-out');
      setTimeout(()=>{ if(parent && el.parentElement===parent) parent.removeChild(el); parent.dataset.locked=''; }, hitCooldown);
    };
    el.addEventListener('click', onTap, {passive:true});
    el.addEventListener('touchstart', onTap, {passive:true});
    return el;
  }

  function activeCount(){ return cells.reduce((a,c)=>a+(c.firstElementChild?1:0),0); }

  function loopSpawn(){
    if(!running) return;
    const t=nowms();
    // اخفاء العناصر المنتهية بعمرها بانيميشن نزول
    cells.forEach(c=>{
      const it=c.firstElementChild;
      if(!it) return;
      const born=Number(it.dataset.born||t);
      if(t-born>itemLifetime){
        it.classList.add('pop-out');
        setTimeout(()=>{ if(c.firstElementChild===it) c.removeChild(it); }, 150);
      }
    });
    // إضافة عناصر حتى الحد الأقصى
    const room=Math.max(0, maxActive - activeCount());
    for(let i=0;i<room;i++){
      const empty=cells.filter(c=>!c.firstElementChild && !c.dataset.locked);
      if(!empty.length) break;
      rpick(empty).appendChild(createItem());
    }
  }

  // ضغط على فتحة فاضية = يخفي اللي فيها أسرع (سلوك النسخة السابقة)
  cells.forEach(c=>{
    c.addEventListener('click', ()=>{
      if(!running) return;
      const it=c.firstElementChild;
      if(it){
        it.classList.add('pop-out');
        setTimeout(()=>{ if(c.firstElementChild===it) c.removeChild(it); }, 120);
      }
    }, {passive:true});
  });

  function bumpDifficulty(){
    spawnInterval=Math.max(360, spawnInterval-40);
    itemLifetime =Math.max(550, itemLifetime-35);
    if(maxActive<5) maxActive+=1;
    if(spawnTimer) clearInterval(spawnTimer);
    spawnTimer=setInterval(loopSpawn, spawnInterval);
  }

  function tick(){
    if(!running) return;
    timeLeft--; timeEl.textContent=String(timeLeft);
    if(timeLeft<=0) endGame();
  }

  function endGame(){
    running=false; clearTimers(); clearCells(); startBtn.disabled=false;
    if(score>best){ best=score; localStorage.setItem('fx_best', String(best)); bestEl.textContent=String(best); }
    if(score>=goalScore) showToast(`🎉 جامد! عدّيت الهدف (${goalScore}+). نتيجتك: ${score}`, '#9effc7');
    else showToast(`انتهى الوقت! درجتك: ${score} — معلش حاول تاني يمكن تكسب 😂`, '#ffd1dc');
  }

  function start(){
    reset();
    running=true; startBtn.disabled=true;
    timeLeft=30; timeEl.textContent='30'; score=0; scoreEl.textContent='0';
    loopSpawn();
    spawnTimer=setInterval(loopSpawn, spawnInterval);
    tickTimer=setInterval(tick,1000);
    difficultyTimer=setInterval(bumpDifficulty,5000);
  }

  startBtn.addEventListener('click', start);
  howBtn.addEventListener('click', ()=> showToast('📌 الطرد +100، القنبلة −50، البونص +150 — الهدف 4000+', '#bfe9ff'));

  reset();
</script>
</body>
</html>
